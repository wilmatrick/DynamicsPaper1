%% Document class
\documentclass[iop,revtex4]{emulateapj}

%% General packages
\usepackage{amsmath}
\usepackage{mathrsfs }
\usepackage{lscape}

%% Figure packages
\usepackage{grffile}
\usepackage{subfigure}

%% Referencing
\usepackage{hyperref}

%% Custom macros
\newcommand{\vect}[1]{\boldsymbol{#1}}
\newcommand*\diff{\mathop{}\!\mathrm{d}}
\newcommand*\Diff[1]{\mathop{}\!\mathrm{d^#1}}
\newcommand{\pdf}{\ensuremath{pdf}}
\newcommand{\pmodel}{\ensuremath{p_M}}
\newcommand{\MAP}{MAP}
\newcommand{\MAPs}{MAPs}
\newcommand{\RM}{{\sl RoadMapping}}
\makeatletter
\newcommand{\testlabel}[2]{%
   \protected@write \@auxout {}{\string \newlabel {#1}{{#2}{\thepage}{#2}{#1}{}} }%
   \hypertarget{#1}{#2}
}
\makeatother

%[TO DO: Do not forget to delete makros]
\usepackage[usenames,dvipsnames]{xcolor}
\newcommand{\Wilma}[1]{\textcolor{Magenta}{#1}}
\newcommand{\HW}[1]{\textcolor{Cyan}{#1}}
\newcommand{\Jo}[1]{\textcolor{YellowOrange}{#1}}
\usepackage{soul}
\newcommand{\NEW}[1]{\textbf{\textcolor{ForestGreen}{#1}}}
\newcommand{\OLD}[1]{\st{#1}}
%\newcommand{\NEW}[1]{#1}
%\newcommand{\OLD}[1]{}

%% Abbreviations
\shorttitle{Action-based Dynamical Modelling for the Milky Way Disk}
\shortauthors{Trick et al.}

\begin{document}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%TITLE
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\title{Action-based Dynamical Modelling for the Milky Way Disk\\}

%% Authors    
\author{Wilma H. Trick\altaffilmark{1,2},  Jo Bovy\altaffilmark{3}, and Hans-Walter Rix\altaffilmark{1}}

%% Affiliations
\altaffiltext{1}{Max-Planck-Institut f\"ur Astronomie, K\"onigstuhl 17, D-69117 Heidelberg, Germany}
\altaffiltext{2}{Correspondence should be addressed to trick@mpia.de.}
\altaffiltext{3}{Department of Astronomy and Astrophysics, University of Toronto, 50 St. George Street, Toronto, ON, M5S 3H4, Canada}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%ABSTRACT
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\begin{abstract}
We present \RM{}, a full-likelihood dynamical modelling machinery that aims to recover the Milky Way's (MW) gravitational potential from large samples of stars in the Galactic disk. 
\RM{} models the observed positions and velocities of stars with a parametrized, three-integral distribution function (DF) in a parametrized axisymmetric potential. 
\OLD{We create and analyse a large suite of mock data sets and develop qualitative ``rules of thumb'' how data, model and machinery affect constraints on the potential and DF most}. 
\NEW{We investigate how properties of data, model and machinery affect constraints on the potential and DF. By analyzing large sets of idealized mock data---using, e.g., the isochrone potential, axisymmetric DFs, contiguous survey selection functions (SF) and negligible measurement errors in many tests---we perform a differential diagnosis of different isolated modelling aspects.} Overall, we find that the potential can be reliably recovered with \RM{}, even if the model assumptions are slightly wrong. \NEW{Specifically, our key results are: (i)} If the MW's true gravitational potential is not included in the assumed family of parametrized model potentials, we can---at least in the axisymmetric case---still find a potential that robustly approximates the potential within the limitations of the model. 
\NEW{(ii)}  Modest systematic differences between the true and best-fit model DF are inconsequential. \NEW{For example, when} \OLD{When} defining sub-populations by binning stars according to their chemical abundances, finite bin sizes and abundance errors do not affect the modelling as long as the DF parameters of neighbouring bins do not differ by more than $20\%$.
\NEW{(iii)} \OLD{While hotter} \NEW{Hotter} populations are less affected by pollution \OLD{and} \NEW{or} misjudgements of the proper motion uncertainty\NEW{. Cooler} \OLD{, cooler} populations recover the Galactic rotation curve more reliably. 
\NEW{In general, we showed that} \RM{} gives constraints of high precision \NEW{on both potential and DF parameters (iv)} \OLD{(i)} for large sample sizes, \NEW{(v)} \OLD{(ii)} for survey volumes of large radial and vertical coverage, \OLD{and (iii)} \NEW{or (vi)} as long as the proper motion uncertainties are well known and even as large as $5 \ \text{mas yr}^{-1}$. Unbiased potential estimates are ensured, \NEW{(vii)} \OLD{(i)} for small to moderate misjudgements of the spatial \NEW{SF} \OLD{selection function}, \NEW{(viii)} \OLD{(ii)} if distances are known only to within $10\%$, or \NEW{(ix)} \OLD{(iii)} if proper motion uncertainties are known within $10\%$. 
Challenges are the rapidly increasing computational costs for high precision likelihood evaluations required for large sample sizes. 
Overall, \RM{} is well suited to making precise new measurements of the MW's potential with data from the 2017 Gaia release. 

\Wilma{[TO DO: Relate error results with typical GAIA errors.]}
\Wilma{[TO DO: Abstract has to be shorter - 250 words maximum.]} 
\end{abstract}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%KEYWORDS
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\keywords{Galaxy: disk --- Galaxy: fundamental parameters --- Galaxy: kinematics and dynamics --- Galaxy: structure}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%INTRODUCTION
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Introduction} \label{sec:intro}

Through dynamical modelling we can infer the Milky Way's (MW) gravitational potential from stellar motions (\citealt{2008gady.book.....B,2011Prama..77...39B,2013A&ARv..21...61R}). Observational information on the 6D phase-space coordinates of stars is currently growing at a rapid pace, and will be taken to a whole new level in quantity and precision by the upcoming data from the Gaia mission \citep{2001A&A...369..339P}. Yet, rigorous and practical modelling tools that turn position-velocity data of individual stars into constraints both on the gravitational potential and on the distribution function (DF) of stellar orbits are scarce \citep{2013A&ARv..21...61R}.

The Galactic gravitational potential is fundamental for understanding the MW's dark matter and baryonic structure \citep{2012EPJWC..1910002M,2013A&ARv..21...61R,2013PhR...531....1S,2014JPhG...41f3101R} and the stellar-population-dependent orbit DF is a basic constraint on the Galaxy's formation history \citep{2013NewAR..57...29B,2015MNRAS.449.3479S}.

There is a variety of practical approaches to dynamical modelling of discrete collisionless tracers, such as the stars in the MW, e.g., Jeans modelling (\citealt{1989MNRAS.239..605K}; \citealt{2012ApJ...756...89B}; \citealt{2012MNRAS.425.1445G}; \citealt{2013ApJ...772..108Z}; \citealt{2015MNRAS.452..956B}), action-based DF modelling (\citealt{2013ApJ...779..115B}; \citealt{2014MNRAS.445.3133P}; \citealt{2015MNRAS.449.3479S}), torus modelling (\citealt{2008MNRAS.390..429M}; \citealt{2012MNRAS.419.2251M}; \citealt{2013MNRAS.433.1411M}), or made-to-measure modelling (\citealt{1996MNRAS.282..223S}; \citealt{2007MNRAS.376...71D}; or \citealt{2014MNRAS.443.2112H}). Most of them---explicitly or implicitly---describe the stellar distribution through a DF. Not all of them avoid binning to exploit the full discrete information content of the data.

\Wilma{[TO DO: Magorrian (2014) has provided a framework for constraining the potential without assuming a particular parametrized form for the DF. Whilst Magorrian's method is computationally intensive, it should be referenced in the introduction as it relates to the later discussion of choosing a particular DF parametrization.]}

Recently, \citet{2012MNRAS.426.1328B} and \citet{2013ApJ...779..115B} proposed \OLD{to constrain} \NEW{constraining} the MW's gravitational potential by combining parametrized axisymmetric potential models with DFs that are simple analytic functions of the three orbital actions to model discrete data.

\citet{2013ApJ...779..115B} (BR13 hereafter) put this in practice by implementing a rigorous modelling approach for so-called mono-abundance populations (\MAPs{}), i.e, sub-sets of stars with similar $[\mathrm{Fe}/\mathrm{H}]$ and $[\alpha/\mathrm{Fe}]$ within the Galactic disk, which seem to follow simple DFs \citep{2012ApJ...751..131B,2012ApJ...755..115B,2012ApJ...753..148B}. Given an assumed (axisymmetric) model for the Galactic potential and action-based DF \citep{2010MNRAS.401.2318B,2011MNRAS.413.1889B,2013MNRAS.434..652T} they calculated the likelihood of the observed ($\vec{x},\vec{v}$) for each \MAP{}, using SEGUE G-dwarf stars \citep{2009AJ....137.4377Y}. They also accounted for the complex, but known selection function of the kinematic tracers \citep{2012ApJ...753..148B}. For each \MAP{} the modelling resulted in an independent estimate of the same gravitational potential. Taken as an ensemble, they constrained the disk surface density over a wide range of radii ($\sim 4-9~\text{kpc}$), and powerfully constrained the disk mass scale length and the stellar-disk-to-dark-matter ratio at the Solar radius. 

BR13 made however a number of quite severe and idealizing assumptions about the potential, the DF and the knowledge of observational effects. These idealizations could plausibly translate into systematic errors on the inferred potential, well above the formal error bars of the upcoming surveys with their wealth and quality of data.

In this work we present \RM{} (``\textsc{R}ecovery of the \textsc{O}rbit \textsc{A}ction \textsc{D}istribution of \textsc{M}ono-\textsc{A}bundance \textsc{P}opulations and \textsc{P}otential \textsc{IN}ference for our \textsc{G}alaxy'')---an improved, refined, flexible, robust and well-tested version of the original dynamical modelling machinery by BR13. Our goal is to explore which of the assumptions BR13 made and which other aspects of data, model and machinery limit \RM{}'s recovery of the true gravitational potential.

We investigate the following aspects of the \RM{} machinery that become especially important for a large number of stars: (i) Numerical inaccuracies must not be an important source of systematics (Section \ref{sec:likelihood}). (ii) As parameter estimates become much more precise, we need more flexibility in the potential and DF model and efficient strategies to find the best fit parameters. The improvements made in \RM{} as compared to the machinery used in BR13 are presented in Section \ref{sec:fitting}. (iii) \RM{} should be an unbiased estimator (Section \ref{sec:largedata}).

We also explore how different aspects of the observational experiment design impact the parameter recovery: (i) We consider the importance of the survey volume geometry, size, shape and position within the MW to constrain the potential (Section \ref{sec:results_obsvolume}). (ii) We ask what happens if our knowledge of the sample selection function is imperfect, and potentially biased (Section \ref{sec:results_incompR}). (iii) We investigate how to best account for individual, and possibly misjudged, measurement uncertainties (Section \ref{sec:results_errors}). (iv) We determine which of several stellar sub-populations is best for constraining the potential (Section \ref{sec:results_temperature}). 

One of the strongest assumptions is \OLD{to restrict} \NEW{restricting} the dynamical modelling to a certain family of parametrized functions for the gravitational potential and the DF. We investigate how well we can hope to recover the true potential, when our models do not encompass the true DF (Section \ref{sec:results_mixedDFs}) and potential (Section \ref{sec:results_potential}).

For all of the above aspects we show some plausible and illustrative examples on the basis of investigating mock data. The mock data is generated from galaxy models presented in Sections \ref{sec:coordinates}-\ref{sec:selectionfunction} following the procedure in \OLD{Section} \NEW{Appendix} \ref{sec:mockdata}, analysed according to the description of the \RM{} machinery in Sections \ref{sec:likelihood}-\ref{sec:fitting}. The results on the investigated modelling aspects are presented in Section \ref{sec:results} and summarized and discussed in Section \ref{sec:discussionsummary}.

\HW{[TO DO: The referee writes: "At the end of the introduction I think that you should refer people more strongly to the results section as much of section 2 is presenting a framework that appears elsewhere." - Yes, that's right. But in the previous paragraph I'm referencing in detail where which result appears in the paper. Is that not enough?]}
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% DYNAMICAL MODELLING
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\section{Dynamical modelling}

In this section we summarize the basic elements of \RM{}, the dynamical modelling machinery presented in this work, which in many respects follows BR13 and makes extensive use of the \texttt{galpy} Python package for galactic dynamics\footnote{\texttt{galpy} is an open-source code that is being developed on \url{http://github.com/jobovy/galpy}. The latest documentation can be found at \url{http://galpy.readthedocs.org/en/latest/}.} \citep{2015ApJS..216...29B}.

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\subsection{Coordinate system} \label{sec:coordinates}

Our modelling takes place in the Galactocentric rest-frame with cylindrical coordinates $\vect{x} \equiv (R,\phi,z)$ and corresponding velocity components $\vect{v} \equiv (v_R,v_\phi,v_z)$. If the stellar phase-space data is given in observed heliocentric coordinates, position $\tilde{\vect{x}} \equiv(\text{RA},\text{Dec},m-M)$ in right ascension RA, declination Dec and distance modulus $(m-M)$, and velocity $\tilde{\vect{v}} \equiv (\mu_\text{RA} \cdot \cos ( \text{Dec}),\mu_\text{Dec},v_\text{los})$ as proper motions and line-of-sight velocity, the data $(\tilde{\vect{x}},\tilde{\vect{v}})$ has to be converted into the Galactocentric rest-frame coordinates $(\vect{x},\vect{v})$ using the Sun's position and velocity. We assume for the Sun
\begin{eqnarray*}
(R_\odot,\phi_\odot,z_\odot) &=&(8~\text{kpc}, 0^\circ, 0~\text{kpc})\\
(v_{R\odot},v_{T\odot},v_{z\odot}) &=& (0,230,0)~\text{km s}^{-1}.
\end{eqnarray*}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\subsection{Actions and potential models}  \label{sec:potentials}

\Wilma{[TO DO: A slightly fuller introduction of the actions is merited. Mention why the actions are introduced. What advantages do they present? Also state that the action-angles are canonical -- this is important later for transformation of the pdf.]}

Orbits in an axisymmetric gravitational potential $\Phi$ are best described and fully specified by the three actions $\vect{J} \equiv (J_R, J_z, J_\phi\equiv L_z)$ (\citealt{2008gady.book.....B}, \S 3.5). Action calculation from a star's phase-space coordinates, $(\vect{x},\vect{v}) \stackrel{\Phi}{\longrightarrow} \vect{J}$, is typically very computationally expensive. \Wilma{[TO DO: The third sentence isn't quite right -- the most general are the triaxial Staeckel potentials of which the axisymmetric Staeckel potentials are special cases and all spherical potentials are special cases of these. The isochrone potential is the most general potential in which the actions are not computed as a quadrature.]} The spherical isochrone potential \citep{1959AnAp...22..126H} and axisymmetric St\"{a}ckel potential \citep{1985MNRAS.216..273D} are the most general (Galactic) potentials, that allow exact action calculations (\citealt{2008gady.book.....B}, \S 3.5.2 and \S 3.5.3). In all other potentials actions have to be numerically estimated. We use the \emph{St\"{a}ckel fudge} by \citet{2012MNRAS.426.1324B} for axisymmetric potentials and action interpolation grids \citep{2012MNRAS.426.1324B,2015ApJS..216...29B} to speed up the calculation. The latter is one of the improvements employed by \RM{}, which was not used in BR13.

For the gravitational potential in our modelling we assume a family of parametrized models. We use: The MW-like potential from BR13 (\texttt{MW13-Pot}) with bulge, disks and halo; the spherical isochrone potential (\texttt{Iso-Pot}); and the 2-component Kuzmin-Kutuzov St\"{a}ckel potential (\citealt{1994AA...287...43B}; \texttt{KKS-Pot}), which also displays a disk and halo structure. Table \ref{tbl:referencepotentials} summarizes all reference potentials used in this work together with their free parameters $p_\Phi$. The density distribution of these potentials is illustrated in Figure \ref{fig:ref_pots}.

\Wilma{[TO DO: The potential discussion could be put into a separate section. Also mention that the circular speed at the Sun is the same for all three potentials. Re-iterate that the reason for using the isochrone and Staeckel potential is the ease with which the actions can be computed.]}

%====================
\begin{deluxetable*}{llcll}[!htbp]
\tabletypesize{\scriptsize}
\tablecaption{Axisymmetric gravitational potential models used \OLD{troughout} \NEW{throughout} this work. The potential parameters are fixed for the mock data creation at the values given in this table, which we susequently aim to recover with \RM{}. The parameters of \texttt{MW13-Pot} and \texttt{KKS-Pot} were chosen by eye to resemble the \texttt{MW14-Pot} (see Figure \ref{fig:ref_pots}). We use $v_\text{circ}(R_\odot)$ = $230~\text{km s}^{-1}$ as the circular velocity at the Sun for all potentials in this work. \label{tbl:referencepotentials}}
\tablewidth{0pt}
\tablehead{
\colhead{name} & \colhead{potential model} & \multicolumn{2}{c}{parameters $p_\Phi$} & \colhead{action calculation}}
\startdata
\texttt{Iso-Pot}      & isochrone potential\tablenotemark{(a)} & $b$& $0.9~\text{kpc}$ & \textbf{\emph{analytic and exact}} \\
                               & \citep{1959AnAp...22..126H} &                                            &                               & (\citealt{2008gady.book.....B}, \S 3.5.2) \\
\tableline
\texttt{KKS-Pot}    & 2-component                            & $\Delta$                                              & $0.3$   & \textbf{\emph{exact}} \\
                               & Kuzmin-Kutuzov-                      & $\left(\frac{a}{c}\right)_\text{Disk}$ & $20$    & using interpolation\\ 
                               & St\"{a}ckel potential\tablenotemark{(b)} & $\left(\frac{a}{c}\right)_\text{Halo}$ & $1.07$ &  on action grid \\
                               & \hspace{0.3cm} (disk + halo) & $k$                                                       & $0.28$ &  \citep{2012MNRAS.426.1324B,2015ApJS..216...29B}\\
                               & \citep{1994AA...287...43B}                               &                                                              &               &  \\
                               &                                                       &                                                              &                & \\
\tableline
\texttt{MW13-Pot} & MW-like potential\tablenotemark{(c)} with & $R_d$ & $3~\text{kpc}$ & \textbf{\emph{approximate}} \\ 
                               & Hernquist bulge,                         & $z_h$ & $0.4~\text{kpc}$  & using \emph{St\"{a}ckel fudge} \\
                               & spherical power-law halo,        & $f_h$ & $0.5$ & \citep{2012MNRAS.426.1324B} \\
                               & 2 exponential disks                    & $\frac{\diff \ln(v_\text{circ}(R_\odot))}{ \diff \ln(R)}$ & $0$  & and interpolation on action grid \\
                               & \hspace{0.3cm} (stars + gas)  &  & & \\
                               & \citep{2013ApJ...779..115B} & & & \\
\tableline
\texttt{MW14-Pot} & MW-like potential\tablenotemark{(d)} with &  & & \textbf{\emph{approximate}} \\
                               & cut-off power-law bulge, & & & (same as \texttt{MW13-Pot}) \\
                               & Miyamoto-Nagai stellar disk, & & & \\
                               & NFW halo & & & \\
                               & \citep{2015ApJS..216...29B} & & & 
\enddata
\tablenotetext{(a)}{The free parameter of the spherical \texttt{Iso-Pot} is the isochrone scale length $b$.} 
\tablenotetext{(b)}{The coordinate system of each of the two St\"{a}ckel-potential components of the \texttt{KKS-Pot} is $R^2 / (\tau_{i,p}+\alpha_p) + z^2 / (\tau_{i,p}+\gamma_p)=1$ with $p \in \{\text{Disk},\text{Halo}\}$ and $\tau_{i,p} \in \{\lambda_p,\nu_p\}$. Both components have the same focal distance $\Delta \equiv \sqrt{\gamma_p-\alpha_p}$, to ensure that the superposition itself is a St\"{a}ckel potential. The axis ratio of the coordinate surfaces $\left(a/c\right)_p := \sqrt{\alpha_p /\gamma_p}$ describes the flatness of each component. $k$ is the relative contribution of the disk mass to the total mass.} 
\tablenotetext{(c)}{The free parameters of the \texttt{MW13-Pot} are stellar disk scale length $R_d$ and height $z_d$, the relative halo contribution to $v_\text{circ}^2(R_\odot)$, $f_h$, and the slope of the rotation curve, $\left[\diff \ln(v_\text{circ}(R_\odot))\right] /  \left[ \diff \ln(R)\right]$.} 
\tablenotetext{(d)}{The \texttt{MWPotential2014} by \citet{2015ApJS..216...29B} (see their Table 1) has $v_\text{circ}(R_\odot)=220~\text{km s}^{-1}$. We use however $v_\text{circ}(R_\odot)=230~\text{km s}^{-1}$.} 
\end{deluxetable*}
%====================

%====================
\begin{figure*}[!htbp]
\includegraphics[width=\textwidth]{figs/reference_potentials.eps}
\caption{Density distribution of the four reference galaxy potentials in Table \ref{tbl:referencepotentials}. These potentials are used throughout this work to create and model mock data with \RM{}.}
\label{fig:ref_pots}
\end{figure*}
%====================

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\subsection{Stellar distribution functions} \label{sec:qDF}

The action-based quasi-isothermal distribution function (qDF) by \citet{2010MNRAS.401.2318B} and \citet{2011MNRAS.413.1889B} is a simple DF which we will employ as a specific example throughout this work to describe individual stellar sub-populations. This is motivated by the findings of \citet{2012ApJ...751..131B,2012ApJ...755..115B,2012ApJ...753..148B} and \citet{2013MNRAS.434..652T} \OLD{about} \NEW{on} the simple phase-space structure of stellar \MAPs{} and BR13's successful application. The qDF has the form
\begin{eqnarray}
&&\text{qDF}(\vect{J} \mid p_\text{DF}) \nonumber\\
&&= f_{\sigma_R}\left(J_R,L_z \mid p_\text{DF}\right) \times f_{\sigma_z}\left(J_z,L_z \mid p_\text{DF}\right)\label{eq:df_general}\end{eqnarray}
with some free parameters $p_\text{DF}$ and
\begin{eqnarray}
f_{\sigma_R}\left(J_R,L_z \mid p_\text{DF}\right) &=& n \times \frac{\Omega}{\pi\sigma_R^2(R_g) \kappa}\exp\left(-\frac{\kappa J_R}{\sigma_R^2(R_g)} \right) \nonumber\\
&& \times \left[1+\tanh\left(L_z/L_0\right) \right]\\
f_{\sigma_z}\left(J_z,L_z \mid p_\text{DF} \right) &=& \frac{\nu}{2 \pi \sigma_z^2(R_g)} \exp\left( -\frac{\nu J_z}{\sigma_z^2(R_g)} \right)
\end{eqnarray}
\citep{2011MNRAS.413.1889B}. Here $R_g$, $\Omega$,  $\kappa$ and $\nu$ are functions of $L_z$ and denote respectively the \OLD{(guiding-center)} \NEW{guiding-center} radius, circular, radial/epicycle and vertical frequency of the \NEW{near-}circular orbit with angular momentum $L_z$ in a given potential. The term $\left[1+\tanh\left(L_z/L_0\right) \right]$ suppresses counter-rotation for orbits in the disk with \OLD{$L \gg L_0$} \NEW{$L_z \ll L_0$} \Jo{[TO DO: Not sure, if the correction by the referee is correct. Ask Jo.]} (with $L_0 \sim 10~\text{km s}^{-1}~ \text{kpc}$).

%====================
\begin{deluxetable*}{lccccc}[!htbp]
\tabletypesize{\scriptsize}
\tablecaption{Reference parameters for the qDF in Equations \eqref{eq:df_general}-\eqref{eq:sigmazRg}, used to create 6D phase-space mock data sets for stellar populations of different kinematic temperature. The parameters of the \texttt{cooler} \& \texttt{colder}  (\texttt{warmer}) qDFs were chosen to have the same anisotropy $\sigma_{R,0}/\sigma_{z,0}$ as the \texttt{hot} (\texttt{cool}) qDF, with $X$ being a free parameter describing the temperature difference. Hotter populations have shorter tracer scale lengths \citep{2012ApJ...753..148B} and the velocity dispersion scale lengths were fixed according to \citet{2012ApJ...755..115B}. \label{tbl:referenceMAPs}}
\tablewidth{0pt}
\tablehead{
\colhead{name} & \multicolumn{5}{c}{qDF parameters $p_\text{DF}$}\\
                       & \colhead{$h_R$ [kpc]} & \colhead{$\sigma_{R,0}$ [$\text{km s}^{-1}$]} & \colhead{$\sigma_{z,0}$ [$\text{km s}^{-1}$]} & \colhead{$h_{\sigma,R}$ [kpc]} & \colhead{$h_{\sigma,z}$ [kpc]}}
\startdata
\texttt{hot}    & 2   & 55 & 66 & 8 & 7\\
\texttt{cool}   & 3.5 & 42 & 32 & 8 & 7\\
\tableline
\texttt{cooler}    & $3$ & $27.5$ & $33$ & $8$ & $7$ \\
\texttt{colder}    & $2  +X  \%$ & $55-X  \%$  & $66-X  \%$ & $8$ & $7$ \\
\texttt{warmer} & $3.5-X  \%$ & $42+X  \%$ & $32+X  \%$ & $8$ & $7$
\enddata
\end{deluxetable*}
%====================

Following BR13, we choose the functional forms
\begin{eqnarray}
n(R_g \mid p_\text{DF}) &\propto& \exp\left(-\frac{R_g}{h_R} \right)\\
\sigma_R(R_g \mid p_\text{DF}) &=& \sigma_{R,0} \times \exp\left(- \frac{R_g-R_\odot}{h_{\sigma,R}} \right)\label{eq:sigmaRRg}\\
\sigma_z(R_g \mid p_\text{DF}) &=& \sigma_{z,0} \times \exp\left(- \frac{R_g-R_\odot}{h_{\sigma,z}} \right)\label{eq:sigmazRg},
\end{eqnarray}
which indirectly set the stellar number density and radial and vertical velocity dispersion profiles. The qDF has therefore a set of five free parameters $p_\text{DF}$: the density scale length of the tracers $h_R$, the radial and vertical velocity dispersion at the Solar position $R_\odot$, $\sigma_{R,0}$ and $\sigma_{z,0}$, and the scale lengths $h_{\sigma,R}$ and $h_{\sigma,z}$, that describe the radial decrease of the velocity dispersion. \RM{} allows to fit any number of DF parameters simultaneously, while BR13 kept $\{\sigma_{R,0},h_{\sigma,R}\}$ fixed. Throughout this work we make use of a few example stellar populations whose qDF parameters are given in \OLD{in} Table \ref{tbl:referenceMAPs}: Most tests use the \texttt{hot} and \texttt{cool} qDFs, which correspond to kinematically hot and cool populations, respectively. \Wilma{[TO DO: explain what X is in the text.]}

One indispensable step in our dynamical modelling technique (Section \ref{sec:likelihood}), as well as in creating mock data (\OLD{Section} \NEW{Appendix} \ref{sec:mockdata}), is to calculate the (axisymmetric) spatial tracer density $\rho_\text{DF}(\vect{x} \mid p_{\Phi},p_\text{DF})$ for a given DF and potential. Analogously to BR13, 
\begin{eqnarray}
&&\rho_\text{DF}(R,|z| \mid p_{\Phi},p_\text{DF}) \nonumber\\
&&= \int_{-\infty}^{\infty} \text{DF}(\vect{J}[R,z,\vect{v} \mid p_{\Phi}] \mid p_\text{DF}) \Diff3 v  \nonumber\\
&&\approx \int_{-n_\sigma \sigma_R(R \mid p_\text{DF})}^{n_\sigma \sigma_R(R \mid p_\text{DF})} \int_{-n_\sigma\sigma_z(R \mid p_\text{DF})}^{n_\sigma \sigma_z(R \mid p_\text{DF})} \int_{0}^{1.5 v_\text{circ}(R_\odot)}  \nonumber\\
& & \hspace{1cm} \text{DF}(\vect{J}[R,z,\vect{v} \mid p_{\Phi}] \mid p_\text{DF}) \diff v_T \diff v_z \diff v_R, \label{eq:tracerdensity}
\end{eqnarray}
where $\sigma_R(R \mid p_\text{DF})$ and $\sigma_z(R \mid p_\text{DF})$ are given by Equations \eqref{eq:sigmaRRg} and \eqref{eq:sigmazRg}.\footnote{The integration ranges over the velocities are motivated by Figure \ref{fig:kks2WedgeEx_xv} and $n_\sigma$ should be chosen as $n_\sigma \sim 5$ \Wilma{[TO DO: The footnote says 'should be chosen as' -- add a forward reference to Fig. 4]}. The integration range $[0,1.5 v_\text{circ}(R_\odot)]$ over $v_T$ is in general sufficient, only for observation volumes with larger mean stellar $v_T$ this upper limit needs to be increased.} Each integral is evaluated using a $N_v$-th order Gauss-Legendre quadrature. For a given $p_\Phi$ and $p_\text{DF}$ we explicitly calculate the density on $N_x \times N_x$ regular grid points in the $(R,z)$ plane and interpolate in between using bivariate spline interpolation \Wilma{[TO DO: Do you interpolate in log density?]}. The grid is chosen to cover the extent of the observations (for $|z|\geq0$, because the model is symmetric in $z$ by construction). The total number of actions to be calculated to set up the density interpolation grid is $N_x^2 \times N_v^3$, which is one of the factors limiting the computation speed. To complement the work by BR13, we will specifically work out in Section \ref{sec:likelihood} and Figure \ref{fig:norm_accuracy} how large $N_x$, $N_v$ and $n_\sigma$ have to be chosen to get the density with a sufficiently high numerical accuracy. 

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\subsection{Selection functions} \label{sec:selectionfunction}

\Wilma{[TO DO: Referee thinks the selection volumes are unrealistic. Hans-Walter comments: "how to deal with complex sampling volumes has been demonstrated in Bovy et al 2013 and 2015; the point here is to make a generic exploration of search volume shapes." Stress this in this text.]}

\Wilma{[TO DO: An entire section dedicated to this topic seems unnecessary. Mention quickly at beginning of "Data likelihood" section.]}

Any survey's selection function (SF) can be understood as defining an effective sample sub-volume in the space of observables, e.g., position on the sky (limited by the pointing of the survey), distance from the Sun (limited by brightness and detector sensitivity), colors and metallicity of the stars (limited by survey mode and targeting). In our modelling we use simple spatial SFs, which describe the probability to observe a star at position $\vect{x}$,
\begin{eqnarray*}
\text{SF}(\vect{x}) \equiv \begin{cases}
\text{completeness}(\vect{x}) &\text{if $\vect{x}$ within obs. volume,}\\
0 & \text{if $\vect{x}$ outside.}
\end{cases}
\end{eqnarray*}

The SF of the SEGUE survey \citep{2012ApJ...753..148B} used by BR13 consists of many pencil-beams. In anticipation of large contiguous volume surveys like Gaia, we use SFs that span large observed volumes of simple geometrical shapes: a sphere of radius $r_\text{max}$ with the Sun at its center; or an angular segment of an cylindrical annulus (wedge), i.e., the volume with $R \in [R_\text{min},R_\text{max}],\phi \in [\phi_\text{min},\phi_\text{max}],z \in [z_\text{min},z_\text{max}]$ within the model Galaxy. The sharp outer edge of the survey volume could be interpreted as a detection limit in apparent brightness in the case where all stars have the same luminosity. We set $0 \leq \text{completeness}(\vect{x}) \leq 1$ everywhere inside the observed volume, so it can be understood as a position-dependent detection probability. Unless explicitly stated otherwise, we simplify to $\text{completeness}(\vect{x}) = 1$.

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\subsection{Data likelihood} \label{sec:likelihood}

\Wilma{[TO DO: The selection function can be briefly mentioned at the beginning of this section and stated that you assume here for simplicity it is a function of $\vec{x}$.]}

As data $D$ we consider here the positions and velocities of a sub-population of stars within a given survey selection function $\text{SF}(\vect{x})$,
\begin{eqnarray*}
D  \equiv \{ \vect{x}_i,\vect{v}_i \mid && \text{(star $i$ in given sub-population)}\nonumber\\
&\wedge& (\text{SF}(\vect{x}_i) > 0) \}.
\end{eqnarray*}

We fit a model potential and DF (here: the qDF) which are specified by a number of fixed and free model parameters,
\begin{eqnarray*}
\pmodel \equiv \{ p_\text{DF} , p_\Phi \}.
\end{eqnarray*}
The orbit of the $i$-th star in a potential with $p_\Phi$ is labelled by the actions $\vect{J}_i := \vect{J}[\vect{x}_i,\vect{v}_i\mid p_{\Phi}]$ and the DF evaluated for the $i$-th star is then $\text{DF}(\vect{J}_i \mid \pmodel) := \text{DF}(\vect{J}[\vect{x}_i,\vect{v}_i\mid p_{\Phi}] \mid p_\text{DF})$.

%====================
\begin{figure*}[!htbp]
\centering
\plotone{figs/normalisation_accuracy_4.eps}
\caption{Relative error of the likelihood normalisation, $\delta M_\text{tot}$, in Equation \eqref{eq:relerrlikelihood} depending on the accuracy of the grid-based density calculation in Equation \eqref{eq:tracerdensity} (and surrounding text) in five spherical observation volumes with different radius $r_\text{max}$. (Test \ref{test:norm_accuracy} in Table \ref{tbl:tests} summarizes the model parameters.) The tracer density in Equation \eqref{eq:tracerdensity} is calculated on $N_x\times N_x$ spatial grid points in $R \in [R_\odot \pm r_\text{max}]$ and $|z| \in [0,r_\text{max}]$. The integration over the velocities is performed with Gauss-Legendre quadratures of order $N_v$ within an integration range of $\pm n_\sigma$ times the dispersion $\sigma_R(R)$ and $\sigma_z(R)$ (and $[0,1.5v_\text{circ}]$ in $v_T$). (We vary $N_x$, $N_v$ and $n_\sigma$ separately and keep the other two fixed at the values indicated above each panel.) We calculate the ``true'' normalisation $M_\text{tot}$ in Equation \eqref{eq:relerrlikelihood} with high accuracy as $M_\text{tot} \equiv M_\text{tot,approx}(N_x=20,N_v=56,n_\sigma=7)$. The black dots indicate the accuracy used in our analyses: It is better than $0.001\%$ (dotted line). We find that the accuracy depends on the \emph{spatial} resolution of the grid and requires more accurate integrations over the \emph{velocity} for larger volumes within which the density varies more strongly. \Wilma{[TO DO: it wasn't clear to me that the 'truth' normalization used a high enough set of parameters. $N_x=20$, $N_v=56$ and $n_\sigma=7$ only seem slightly larger than the values actually compared to.]}}
\label{fig:norm_accuracy}
\end{figure*}
%====================

\Jo{[TO DO: The referee writes: "The Jacobian from J,theta to x,v should be mentioned here." - I don't know, where this is important. We treat the normalisation integral never as integral over J, theta, but always as integral over x,v and qDF as function of xv.]}

The likelihood of the data given the model is, following BR13,
\begin{eqnarray}
&&\mathscr{L}(D \mid \pmodel) \nonumber\\
&&\equiv \prod_i^{N_*} p(\vect{x}_i,\vect{v}_i \mid \pmodel) \nonumber\\
&&= \prod_i^{N_*} \frac{\text{DF}(\vect{J}_i \mid \pmodel) \cdot \text{SF}(\vect{x}_i)}{\int  \text{DF}(\vect{J} \mid \pmodel) \cdot \text{SF}(\vect{x})  \Diff 3 x \Diff 3 v}\nonumber\\
&&\propto \prod_i^{N_*} \frac{\text{DF}(\vect{J}_i \mid \pmodel)}{\int \rho_\text{DF}(R,|z| \mid \pmodel) \cdot \text{SF}(\vect{x}) \Diff 3 x}, \label{eq:prob}
\end{eqnarray}
where $N_*$ is the number of stars in $D$, and in the last step we used Equation \eqref{eq:tracerdensity}. $\prod_i\text{SF}(\vect{x}_i)$ is independent of \pmodel{}, so we treat it as unimportant proportionality factor. We find the best fitting \pmodel{} by maximizing the posterior probability distribution $\pdf{}(\pmodel \mid D)$, which is, according to Bayes' theorem, proportional to the likelihood $\mathscr{L}(D\mid \pmodel)$ times a prior $p(\pmodel)$. \Wilma{[TO DO: pdf should be defined in a separate equation.]} We assume flat priors in both $p_\Phi$ and
\begin{eqnarray}
p_\text{DF} := \{ \ln h_R, \ln \sigma_{R,0}, \ln \sigma_{z,0}, \ln h_{\sigma,R}, \ln h_{\sigma,z} \} \label{eq:p_DF}
\end{eqnarray}
(see Section \ref{sec:qDF}) throughout this work. Then \pdf{} and likelihood are proportional to each other and differ only in units.

\Wilma{[TO DO: Make the normalization discussion a separate section.]}

\Wilma{[TO DO:  The discussion of the likelihood normalization should reference and compare with McMillan and Binney (2013) as the discussion is very similar.]}

The normalisation in Equation \eqref{eq:prob} is a measure for the total number of tracers inside the survey volume,
\begin{equation}
M_\text{tot} \equiv \int  \rho_\text{DF}(R,|z| \mid \pmodel) \cdot \text{SF}(\vect{x}) \Diff 3 x.\label{eq:normalisation}
\end{equation}
In the case of an axisymmetric Galaxy model and $\text{SF}(\vect{x})=1$ within the observation volume (as in most tests in this work), the normalisation is essentially a two-dimensional integral in the $R$-$z$ plane over $\rho_{DF}$ with finite integration limits. We evaluate the integrals using Gauss-Legendre quadratures of order 40. The integral over the azimuthal direction can be solved analytically. 

It turns out that a sufficiently accurate evaluation of the likelihood is computationally expensive, even for only one set of model parameters. This expense is dominated by the number of action calculations required, which in turn depends on $N_*$ and the numerical accuracy of the tracer density interpolation grid with $N_x^2 \times N_v^3$ grid points in Equation \eqref{eq:tracerdensity} needed for the likelihood normalisation in Equation \eqref{eq:normalisation}. The accuracy of the normalisation has to be chosen high enough, such that the resulting numerical error 
\begin{equation}
\delta M_\text{tot} \equiv \frac{M_\text{tot,approx}(N_x,N_v,n_\sigma) -  M_\text{tot} }{M_\text{tot}}\label{eq:relerrlikelihood}
\end{equation}
does not dominate the numerically calculated log-likelihood, i.e.,
\begin{eqnarray}
& &\log \mathscr{L}_\text{approx}(D \mid \pmodel) \nonumber\\
&& = \sum_i^{N_*} \log \text{DF}(\vect{J_i} \mid \pmodel) - N_* \log(M_\text{tot})\nonumber\\
&& - N_* \log (1 + \delta M_\text{tot}),\label{eq:loglikelihood_relerr}
\end{eqnarray}
with
\begin{eqnarray}
\log (1 + \delta M_\text{tot}) \leq \frac{1}{N_{*}},\label{eq:accuracycondition}
\end{eqnarray}
and therefore $\delta M_\text{tot} \lesssim 1/N_*$. Otherwise numerical inaccuracies could lead to systematic biases in the potential and DF recovery. For data sets as large as $N_* = 20,000$ stars, which in the age of Gaia could very well be the case, one needs a numerical accuracy of 0.005\% in the normalisation. Figure \ref{fig:norm_accuracy} demonstrates that the numerical accuracy we use in the analysis, $N_x=16$, $N_v=24$ and $n_\sigma=5$, does satisfy this requirement. This is slightly higher than in BR13, where $N_*$ was only a few $\sim 100$.

\HW{[TO DO: The referee writes "Is there any general advice on how to choose $N_x$, $N_v$ and $N_sigma$? The authors have shown it is OK for the mock datasets but do I have to redo the authors' exercise when I have a real dataset?"]}

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSphFlexErrConv_MC_vs_error_3.eps}
\caption{Number of MC samples $N_\text{samples}$ needed for the numerical convolution of the model probability with the measurement uncertainties in Equation \eqref{eq:errorconv}, given the maximum velocity uncertainty $\delta v_\text{max}$ within the stellar sample with respect to the sample's kinematic temperature $\bar{\sigma}$. Insufficient sampling introduces systematic biases in the parameter recovery; the size of the bias (in units of the standard error (SE) on the parameter estimate) is indicated in the legend. The relation found here, $N_\text{samples} \propto \delta v_\text{max}^2$, was distilled from analyses of mock data sets with different proper motion uncertainties $\delta \mu \in [2,5]~\text{mas yr}^{-1}$ in the absence of position uncertainties (see Test \ref{test:isoSphFlexErrConv_MC_vs_error} in Table \ref{tbl:tests}). The proper motion uncertainty $\delta \mu$ translates to heteroscedastic velocity uncertainties according to $\delta v [\text{km s}^{-1}] \equiv 4.74047 \cdot r[\text{kpc}] \cdot \delta \mu [\text{mas yr}^{-1}]$, with $r$ being the distance of the star from the Sun. Stars with larger $\delta v$ require more $N_\text{samples}$ for the integral over its measurement uncertainties to converge; we therefore show how the $N_\text{samples}$---needed for the \pdf{} of the \emph{whole} data set to be converged---depends on the \emph{largest} velocity error $\delta v_\text{max} \equiv \delta v(r_\text{max})$ within the data set. We used $N_\text{samples} = 800$ and  $1200$ for $\delta \mu \leq 3~\text{mas yr}^{-1}$ and $\delta \mu > 3~\text{mas yr}^{-1}$, respectively, as the reference for the converged convolution integral (see also left panels in Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE}). We plot $\delta v_\text{max}$ in units of the sample temperature, which we quantify by $\bar{\sigma} \equiv (\sigma_{R,0} + \sigma_{z,0})/2$ (see Table \ref{tbl:referenceMAPs} for the \texttt{hot} qDF). This figure was generated from mock data sets with $N_{*}=10,000$. We found that for $N_{*}=5,000$ the required $N_\text{samples}$ remains similar for $b$, but gets smaller for $v_\text{circ}(R_\odot)$. Overall we expect that we need less accuracy and therefore smaller $N_\text{samples}$ for smaller $N_{*}$. \Wilma{[TO DO: Find out where the typical GAIA threshold is for 3 kpc (or whatever is suitable) and draw vertical line. Comment on this in the caption as well.]} \Wilma{[TO DO: Reduce size of caption for Fig 5. More of the details could go in the text.]}}
\label{fig:isoSphFlexErrConv_MC_vs_error}
\end{figure}
%====================

\Wilma{[TO DO: Put error discussion in separate section.]}

Measurement uncertainties of the data have to be incorporated in the likelihood. We assume Gaussian uncertainties in the observable space $\vect{y} \equiv (\tilde{\vect{x}},\tilde{\vect{v}})=(\text{RA},\text{Dec},(m-M),\mu_\text{RA} \cdot \cos (\text{Dec}),\mu_\text{Dec},v_\text{los})$, i.e., the $i$-th star's observed $\vect{y}_i$ is drawn from the normal distribution $N[{\vect{y}_i}',\delta \vect{y}_i] \equiv \prod_i^6 N[{y_{i,k}}',\delta y_{i,k}] =  \prod_i^6 \exp \{-(y_{k}-{y_{i,k}}')^2/ (2 \delta y_{i,k}^2) \} / \sqrt{2 \pi \delta y_{i,k}^2}$, with ${\vect{y}_i}'$ being the star's true phase-space position, $\delta \vect{y}_i$ its uncertainty, and $y_k$ the $k$-th coordinate component of $\vect{y}$. Stars follow the $\text{DF}(\vect{J}[\vect{y}' \mid p_\Phi] \mid p_\text{DF})$ ($\equiv \text{DF}(\vect{y}') \equiv$  for short) convolved with the measurement uncertainties $N[0,\delta \vect{y}_i]$. The selection function SF$(\vect{y})$ acts on the space of (uncertainty affected) observables. Then the probability of one star becomes
\begin{eqnarray}
&&\tilde{p}(\vect{y}_i \mid p_\Phi,p_\text{DF},\delta \vect{y}_i)\nonumber\\
& \equiv& \frac{\text{SF}(\vect{y}_i) \cdot \int \text{DF}(\vect{y}') \cdot N[\vect{y}_i,\delta \vect{y}_i] \Diff{6} y'}{\int \left(  \text{DF}(\vect{y}')  \cdot  \int \text{SF}(\vect{y})  \cdot N[\vect{y}',\delta \vect{y}_i] \Diff{6} y \right) \Diff{6}y'}.
\end{eqnarray}
In the case of uncertainties in distance or (RA,Dec) the evaluation of this is computational expensive---especially if the stars have heteroscedastic $\delta \vect{y}_i$. In practice we compute the convolution using Monte Carlo (MC) integration with $N_\text{samples}$ samples,
\begin{eqnarray}
&&\tilde{p}_\text{approx}(\vect{y}_i \mid p_\Phi,p_\text{DF},\delta \vect{y}_i) \nonumber\\
&&\approx \frac{ \text{SF}(\tilde{\vect{x}}_i)}{M_\text{tot}} \cdot \frac{1}{N_\text{samples}} \sum_n^{N_\text{samples}}  \text{DF}(\tilde{\vect{x}}_i,\vect{v}[\vect{y}'_{i,n}]) \label{eq:errorconv}
\end{eqnarray}
with
\begin{eqnarray}
\vect{y}'_{i,n} \sim N[\vect{y}_i,\delta \vect{y}_i].\nonumber
\end{eqnarray}

\HW{[TO DO: The referee writes: "Equation (15) is a novelty. It is troubling that the tests that use this approximation all seem to use the isochrone but the approximation is still necessary. Is that because it is computationally awkward to calculate this integral or just very slow?"]}

The above approximation also assumes that the star's \emph{position} $\tilde{\vect{x}}_i$ is perfectly measured. As the SF is also velocity independent, this simplifies the normalisation drastically to Equation \eqref{eq:normalisation}. Measurement uncertainties in $\mathrm{RA}$ and $\mathrm{Dec}$ are often negligible anyway. The uncertainties in the Galactocentric \emph{velocities} $\vect{v}_i = (v_{R,i},v_{T,i},v_{z,i})$ depend \OLD{besides} \NEW{not only} on $\delta \vect{\mu}$ and $\delta v_\text{los}$ \NEW{but} also on the distance and its uncertainty, which we do \emph{not} neglect when drawing MC samples $\vect{y}'_{i,n}$ from the full uncertainty distribution $N[\vect{y}_i,\delta \vect{y}_i]$. Figure \ref{fig:isoSphFlexErrConv_MC_vs_error} demonstrates that in the absence of position uncertainties the $N_\text{samples}$ needed for the convolution integral to converge depends as
\begin{equation*}
N_\text{samples} \propto \left( \delta v \right)^2
\end{equation*}
on the uncertainties in the (1D) velocities. We found that the required $N_\text{samples}$ to reach a given accuracy does not depend strongly on the number of stars in the sample. But in general we expect that we need higher accuracy and therefore more $N_\text{samples}$ for larger data sets.

\Wilma{[TO DO: The penultimate sentence of this section contradicts the previous sentence without validation. Why is this?]}

A similar but one-dimensional treatment of measurement uncertainties in only $v_z$ was already applied by BR13.

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%====================
\begin{figure*}[!htbp]
\centering
\includegraphics[width=0.7\textwidth]{figs/isoSphFlex_short_hot_2kpc_triangle_MCMC.eps}
\caption{The \pdf{} in the parameter space $\pmodel{} = \{p_\Phi,p_\text{DF}\}$ for one example mock data set (see Test \ref{test:isoSphFlex} in Table \ref{tbl:tests}). Blue indicates the \pdf{} for the potential parameters $p_\Phi$, green the qDF parameters $p_\text{DF}$. The true parameters are marked by dotted lines. The dark, medium and bright contours in the 2D distributions represent $1\sigma$, $2\sigma$ and $3\sigma$ confidence regions, respectively. The parameters are weakly to moderately covariant, but their level of covariance depends on the actual choice of the mock data's \pmodel{}. The \pdf{} here was sampled using MCMC. The dashed lines in the 1D distributions are Gaussian fits to the histogram of MCMC samples. This demonstrates very well that for such a large number of stars, the \pdf{} approaches the shape of a multi-variate Gaussian, as expected for a maximum likelihood estimator.}
\label{fig:isoSphFlex_triangleplot}
\end{figure*}
%====================

\subsection{Fitting procedure} \label{sec:fitting}

To search the $(p_\Phi,p_\text{DF})$ parameter space for the maximum of the \pdf{} in Equation \eqref{eq:prob}, we go beyond the single fixed grid search by BR13 and employ an efficient two-step procedure: Nested-grid search and Monte-Carlo Markov Chain \NEW{(MCMC)}.

The first step employs a nested-grid search to find the approximate peak and width of the \pdf{} in the high-dimensional \pmodel{}  space with a low number of likelihood evaluations:

\begin{itemize}
\item \emph{Initialization.} For $N_p$ free model parameters \pmodel{} we start with a sufficiently large grid with $3^{N_p}$ regular points.

\item  \emph{Evaluation.} We evaluate the \pdf{} at each grid-point similar to BR13 (their Figure 9):  An outer loop iterates over the potential parameters $p_\Phi$ and pre-calculates all $N_* \times N_\text{samples} + N_x^2 \times N_v^3$ actions required for the likelihood calculation (see Equations \eqref{eq:tracerdensity}, \eqref{eq:prob} and \eqref{eq:errorconv}). Then an inner loop evaluates Equation \eqref{eq:prob} (or \eqref{eq:errorconv}) for all DF parameters $p_\text{DF}$ in the given potential.

\item \emph{Iteration.} For each of the model parameters \pmodel{} we marginalize the \pdf{}. A Gaussian is fitted to the marginalized \pdf{} and the peak $\pm ~ 4\sigma$ become the boundaries of the next grid with $3^{N_p}$ grid points. The grid might be still too coarse or badly positioned to fit Gaussians. In that case we either zoom into the grid point with the highest probability or shift the current range to find new approximate grid boundaries. We proceed with iteratively evaluating the \pdf{} on finer and finer grids, until we have found a reliable 4-sigma fit range in each of the \pmodel{} dimensions. The central grid point is then very close to the best fit \pmodel{}, and the grid range is of the order of the \pdf{} width.

\item \emph{The fiducial qDF.} To save time by pre-calculating actions, they have to be independent of the choice of $p_\text{DF}$. However, the normalisation in Equation \eqref{eq:normalisation} requires actions on a $N_x^2 \times N_v^3$ grid and the grid ranges in velocity space \emph{do} depend on the current $p_\text{DF}$ (see Equation \eqref{eq:tracerdensity}). To relax this, we follow BR13 and use a fixed set of qDF parameters (the \emph{fiducial qDF}) to set the velocity grid boundaries in Equation \eqref{eq:tracerdensity} globally for a given $p_\Phi$. Choosing a fiducial qDF that is very different from the true DF can however lead to large biases in the \pmodel{} recovery. BR13 did not account for that. \RM{} avoids this as follows: To get successively closer to the optimal fiducial qDF---with the (yet unknown) best fit $p_\text{DF}$---we use in each iteration step of the nested-grid search the central grid point of the current \pmodel{} grid as the fiducial qDF's $p_\text{DF}$.  As the nested-grid search approaches the best fit values, the fiducial qDF approaches its optimum as well. 

\item \emph{Computational expense.} Overall the computation speed of this nested-grid approach is dominated (in descending order of importance) by a) the complexity of potential and action calculation, b) the $N_* \times N_\text{samples} + N_x^2 \times N_v^3$ actions required to be calculated per $p_\Phi$, c) the number of potential parameters and d) the number of DF parameters.
\end{itemize}

The second step samples the shape of the \pdf{} using MCMC. Formally, calculating the \pdf{} on a fine grid like BR13 (e.g., with $K=11$ grid points in each dimension) would provide the same information. However the number of expensive \pdf{} evaluations scales as $K^{N_p}$. For a high-dimensional \pmodel{} ($N_p>4$), a MCMC approach might sample the \pdf{} much faster: We use \emph{emcee} by \citet{2013PASP..125..306F} and release the walkers very close to the best fit \pmodel{} found by the nested-grid search, which assures fast convergence in much less than $K^{N_p}$ \pdf{} evaluations. We also use the best fit \pmodel{} of the grid-search as fiducial qDF for the whole MCMC. In doing so, the normalisation varies smoothly with different $\pmodel{}$ and is slightly less sensitive to the accuracy in Equation \eqref{eq:tracerdensity}.

\Wilma{[TO DO: Here a fixed sampling is used for the error samples. I think again you should reference McMillan \& Binney (2013) as they discussed the numerical stability of this method.]}
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% RESULTS
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Results} \label{sec:results}

We are now in a position to examine the limitations of action-based modelling posed in the introduction using our \RM{} machinery. We explore: (i) whether the parameter estimates are unbiased, (ii) the role of the survey volume, (iii) imperfect selection functions, (iv) measurement uncertainties, and what happens if the true (v) DF or (vi) potential are not included in the space of models. We do not explore the breakdown of the assumption that the system is axisymmetric and in steady state.

\NEW{We will rely on mock data as input to explore the limitations of the modelling. The mock data is generated directly from the potential and DF models introduced in Sections \ref{sec:potentials} and \ref{sec:qDF}, following the procedure described in Appendix \ref{sec:mockdata}.} With the exception of the test suite on measurement uncertainties in Section \ref{sec:results_errors}, we assume that phase-space uncertainties are negligible. All tests are also summarized in Table \ref{tbl:tests}. 

\Wilma{[TO DO: It is stated that the breakdown of axisymmetry and steady state assumptions is not explored. \HW{I wonder as well about the impact of resonances, particularly when the data are very high quality.} This cannot be explored in the current setup as the data are generated from an action-based DF but perhaps should be mentioned as a potential limitation of the approach.]}
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{Model parameter estimates in the limit of large data sets} \label{sec:largedata}

\HW{[TO DO: The referee writes: "This seems a good sanity check but should it be published? Fig 6. seems sufficient to me to demonstrate that your code works. I don't think the paper would miss this section."]}

The individual \MAP{}s in BR13 contained typically between 100 and 800 objects, so that each \MAP{} implied a quite broad \pdf{} for the model parameters $\pmodel{}$. Here we explore what happens in the limit of much larger samples, say $N_{*} = 20,000$ objects.  As outlined in Section \ref{sec:likelihood}, the immediate consequence of larger samples is given by the likelihood normalisation requirement $\delta M_\text{tot} \lesssim 1/N_{*}$ (see Equation \eqref{eq:accuracycondition}), which is the modelling aspect that drives the computing time. This issue aside, we would expect that in the limit of large data sets with vanishing measurement uncertainties the \pdf{}s of the \pmodel{} become Gaussian, with a \pdf{} width (i.e., the standard error (SE) on the parameter estimate) that scales as $1/\sqrt{N_{*}}$. Further, we must verify that any bias in the \pdf{} expectation value is considerably less than the error, even for quite large samples.

Using sets of mock data, created according to the procedure in \OLD{Section} \NEW{Appendix} \ref{sec:mockdata} and a fiducial model for \pmodel{} (see Table \ref{tbl:tests}, Tests \ref{test:sqrtNiso}, \ref{test:isoSph_CLT}, and \ref{test:isoSphFlex}), we verified that \RM{} satisfies all these conditions and expectations: Figure \ref{fig:isoSphFlex_triangleplot} illustrates the joint \pdf{}s of all \pmodel{}. The \pdf{} is a multivariate Gaussian that projects into Gaussians when considering the marginalized \pdf{} for all the individual \pmodel{}. Figure \ref{fig:sqrtNiso} then demonstrates that the \pdf{} width indeed scales as $1/\sqrt{N_{*}}$. Figure \ref{fig:isoSph_CLT} illustrates even more that \RM{} behaves like an unbiased maximum likelihood estimator: The average parameter estimates from many mock samples with identical underlying \pmodel{} are very close to the input \pmodel{}, and the distribution of the actual parameter estimates are a Gaussian around it. 
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%====================
\begin{figure}[!htbp]
\plotone{figs/sqrtNiso_Stddev_Vs_N.eps}
\caption{The width of the \pdf{} (see Equation \eqref{eq:prob}) for two fit parameters found from analyses of 132 mock data sets vs. the number of stars in each data set, $N_{*}$. (The mock data was created according to the model parameters given in Test \ref{test:sqrtNiso} in Table \ref{tbl:tests}.) The relative standard error (SE) was found from a Gaussian fit to the marginalized \pdf{} for each model parameter. As can be seen, for large data samples the width of the \pdf{} scales with $1/\sqrt{N_{*}}$ as expected.} 
\label{fig:sqrtNiso}
\end{figure}
%====================

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSph_CLT_2.eps}
\caption{Lack of  bias in the parameter estimates. Maximum likelihood estimators converge to the true parameter values for large numbers of data points and have a Gaussian spread---if the model assumptions are fulfilled. To test that these conditions are satisfied for \RM{}, we create 320 mock data sets, which come from two different stellar populations and five spherical observation volumes (see legends). (All model parameters are summarized in Table \ref{tbl:tests} as Test \ref{test:isoSph_CLT}.) Bias and relative standard error (SE) are derived from the marginalized \pdf{} for two model parameters (isochrone scale length $b$ in the first row and qDF parameter $h_{\sigma,z}$ in the second row). The second column displays a histogram of the 320 bias offsets. As it closely follows a normal distribution, our modelling method is therefore well-behaved and unbiased. The black dots denote the \pdf{} expectation value for the 32 analyses belonging to the same $\pmodel{}$.}
\label{fig:isoSph_CLT}
\end{figure}
%====================

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{The role of the survey volume geometry} \label{sec:results_obsvolume}

To explore the role of the survey volume at given sample size, we devise two suites of mock data sets: 

The first suite draws mock data for two different potentials (\texttt{Iso-Pot} and \texttt{MW13-Pot}) and four volume wedges (see Section \ref{sec:selectionfunction}) with different extent and at {\it different positions within the Galaxy}, illustrated in the upper panel of Figure \ref{fig:wedFlexVol_bias_vs_SE}. Otherwise the data sets are generated from the same \pmodel{} (see Test \ref{test:wedFlexVol} in Table \ref{tbl:tests}). To isolate the role of the survey volume geometry, the mock data sets all have the same number of stars ($N_{*} = 20,000$) in all cases, and are drawn from identical total survey volumes ($4.5~\text{kpc}^3$, achieved by adjusting the angular width of the wedges). The results are shown in Figure \ref{fig:wedFlexVol_bias_vs_SE}.

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/wedFlexVol_bias_vs_SE.eps}
\caption{Bias vs. standard error in recovering the potential parameters for mock data sets drawn from four different wedge-shaped test observation volumes within the Galaxy (illustrated in the upper panel; the corresponding analyses are colour-coded) and two different potentials (\texttt{Iso-Pot} and \texttt{MW13-Pot} from Table \ref{tbl:referencepotentials}; see also Test \ref{test:wedFlexVol} in Table \ref{tbl:tests} for all model parameters used). Standard error and offset were determined from a Gaussian fit to the marginalized \pdf{}. The angular extent of each wedge-shaped observation volume was adapted such that all have a volume of $4.5~\text{kpc}^3$, even though their extent in $(R,z)$ is different. Overall there is no clear trend that an observation volume around the Sun, above the disk or at smaller Galactocentric radii should give remarkably better constraints on the potential than the other volumes. \HW{[TO DO: the referee writes: I understand that the selections used in Fig 9 are illustrative but the pink selection just doesn't seem realistic. I think Fig 8. is a sufficient demonstration of the difference between different selections. Fig. 9 doesn't add anything and is barely discussed in the text. Also, without observational uncertainties (which will be greater for the more distant boxes) the discussion seems superficial. I would consider removing this.]}}
\label{fig:wedFlexVol_bias_vs_SE}
\end{figure}
%====================

The second suite of mock data sets was already introduced in Section \ref{sec:largedata} (see also Test \ref{test:isoSph_CLT} in Table \ref{tbl:tests}), where mock data sets were drawn from five spherical volumes around the Sun with different maximum radius, for two different stellar populations. The results of this second suite are shown in Figure \ref{fig:isoSph_CLT} and exemplify the effect of the {\it size of the survey volume}.

Figure \ref{fig:isoSph_CLT} demonstrates that, given a choice of $p_\text{DF}$, a larger volume always results in tighter constraints. There is no obvious trend that a hotter or cooler population will always give better results; it depends on the survey volume and the model parameter in question. In Figure \ref{fig:wedFlexVol_bias_vs_SE} the wedges all have the same volume and all give results of similar precision. Minor differences (e.g., the \texttt{Iso-Pot} potential being less constrained in the wedge with large vertical but small radial extent) are a special property of the considered potential and parameters, and not a global property of the corresponding survey volume. In the case of an axisymmetric model galaxy, the extent in $\phi$ direction is not expected to matter. Overall radial extent and vertical extent seem to be equally important to constrain the potential. In addition, Figure \ref{fig:wedFlexVol_bias_vs_SE} implies that volume offsets in the radial or vertical direction have at most a modest impact---even in case of the very large sample size at hand.

While it appears that the argument for significant radial and vertical extent is generic, we have not done a full exploration of all combinations of \pmodel{} and volumes.

That in reality different regions in the Galaxy have different stellar number densities, should therefore be the major factor to drive the precision of the potential recovery when choosing a survey volume.
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{Impact of misjudging the selection function of the data set} \label{sec:results_incompR}

The SF (see Section \ref{sec:selectionfunction}) can be very complex and is therefore sometimes not perfectly known. Here we investigate how much this could affect the recovery of the potential. We do this by creating mock data in a spherical survey volume around the Sun (see Test \ref{test:isoSphFlexIncomp} in Table \ref{tbl:tests}) and a spatially varying completeness function
\begin{equation}
\text{completeness}(r) \equiv 1- \epsilon_r \frac{r}{r_\text{max}}, \label{eq:rad_incomp}
\end{equation}
which drops linearly with distance $r$ from the Sun. In the \RM{} analysis however, we assume constant completeness ($\epsilon_r=0$). The incompleteness parameter $\epsilon_r$ of the mock data quantifies therefore by how much we misjudge the SF. This captures the relevant case of stars being less likely to be observed (than assumed) the further away they are (e.g., due to unknown dust obscuration). 

Figure \ref{fig:isoSphFlexIncompR_violins} demonstrates that the potential recovery with \RM{} is very robust against somewhat wrong assumptions about the completeness of the data. The robustness for the \texttt{cool} stellar population is even more striking than for the \texttt{hot} population. The reason for this robustness could be, that much information about the potential comes from the rotation curve measurements in the plane, which is not affected by the incompleteness of the sample. We test this by analysing the data sets from Figure \ref{fig:isoSphFlexIncompR_violins} again, but this time not including tangential velocity measurements (which is done by marginalizing the likelihood in Equation \eqref{eq:prob} over $v_T$). Figure \ref{fig:isoSphFlexIncompR_marginal_violins} shows that in this case the potential is much less tightly constrained, even for 20,000 stars. For only minor deviations of true and assumed completeness ($\epsilon_r \lesssim 0.15$) the true potential is however still included within the errors of our fitting result (see Figure \ref{fig:isoSphFlexIncompR_marginal_violins}).

We found similarly robust results also for a misjudgement of spatial completeness functions varying with the distance from the plane, $|z|$.

\HW{[TO DO: The referee writes: "Isn't the reason for the cold population being more robust that it doesn't have as many stars at large distance as the hot population so it is less affected by the cuts? I suppose this not necessarily true for lines-of-sight in the plane."]}

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSphFlexIncompR_violins_2.eps}
\caption{Impact of misjudging the completeness of the data on the parameter recovery with \RM{}. Each mock data set was created with a different incompleteness parameter $\epsilon_r$ (shown on the $x$-axis, see Equation \eqref{eq:rad_incomp}). (The model parameters are given as Test \ref{test:isoSphFlexIncomp} in Table \ref{tbl:tests}.) The analysis however assumed that all data sets had constant completeness within the survey volume ($\epsilon_r = 0$). The violins show the full shape of the projected \pdf{}s for each model parameter, and the solid lines their true values. The \RM{} method seems to be very robust against small to intermediate deviations between the true and the assumed data incompleteness. (The qDF parameters not shown here exhibit a similar robustness as $h_R$.)} 
\label{fig:isoSphFlexIncompR_violins}
\end{figure}
%====================

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSphFlexIncompR_marginal_violins_3.eps}
\caption{Same as Figure \ref{fig:isoSphFlexIncompR_violins}, but without including information about the tangential velocities in the analysis. This was done by marginalizing the likelihood in Equation \eqref{eq:prob} over $v_T$ (bright grey violins; the dark grey violins are the same as in Figure \ref{fig:isoSphFlexIncompR_violins} for comparison). The parameter recovery is much worse than in Figure \ref{fig:isoSphFlexIncompR_violins}. This could indicate that much of the information about the potential is actually stored in the rotation curve, i.e., $v_T(R)$, which is not affected by removing stars from the data set. But even if we do not include $v_T$ we can still recover the potential within the errors, at least for small ($\epsilon_r \lesssim 0.15$).} 
\label{fig:isoSphFlexIncompR_marginal_violins}
\end{figure}
%====================

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{Measurement uncertainties and their effect on the parameter recovery} \label{sec:results_errors}

\Wilma{[TO DO: Find out what typical GAIA errors are. Find suitable place somewhere in this paper to introduce it.]}

\Wilma{[TO DO: It would be nice to state how the considered errors are related to the anticipated Gaia errors or other surveys.]}

\HW{[TO DO: The referee writes: "What is the motivation for considering these errors?"]}

Measurement uncertainties in proper motions and distance dominate over uncertainties in position on the sky (RA, Dec) and line-of-sight velocity, which can be more accurately determined.

We first investigate the impact of (perfectly known) proper motion uncertainties on the precision of the potential parameter recovery (see Test \ref{test:isoSphFlexErrConv_SE_vs_error} in Table \ref{tbl:tests}). Figure \ref{fig:isoSphFlexErrConv_SE_vs_error} demonstrates that for data sets with $\delta \mu$ as high as $5~\text{mas yr}^{-1}$ the precision degrades by  a factor of no more than $\sim2$ as compared to a data set without measurement uncertainties. The precision gets monotonically better for smaller $\delta \mu$, being larger only by a factor of $\sim 1.15$ at $\delta \mu=1~\text{mas yr}^{-1}$. With relative standard errors on the recovered parameters of only a few percent at most for 10,000 stars, this means we still get quite precise constraints on the potential, as long as we know the proper motion uncertainties perfectly.

We also note that in this case the relative and absolute difference in recovered precision between the precise and the uncertainty-affected data sets does not seem to depend strongly on the kinematic temperature of the stellar population.

Secondly, we investigate the impact of additional measurement uncertainties in distance (modulus). In absence of distance uncertainties the uncertainty-convolved model probability given in Equation \eqref{eq:errorconv} is unbiased (see upper left panel in Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE}).  When including distance (modulus) uncertainties, Equation \eqref{eq:errorconv} is just an approximation for the true likelihood; the systematic bias thus introduced in the parameter recovery gets larger with the size of $\delta (m-M)$, as demonstrated in Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE}, lower panels (see also Test \ref{test:isoSphFlexErrConv_bias_vs_SE} in Table \ref{tbl:tests}).  We find however that in case of $\delta(m-M) \lesssim 0.2 \text{ mag}$ (if also $\delta \mu \lesssim 2 ~\text{mas yr}^{-1}$ and a maximum distance of $r_\text{max} = 3~\text{kpc}$, see Test \ref{test:isoSphFlexErrConv_bias_vs_SE} in Table \ref{tbl:tests}) the potential parameters can still be recovered within $2 \sigma$. This corresponds to a relative distance uncertainty of $\sim10\%$. The overall precision of the potential recovery is also not degraded much by introducing distance uncertainties of less than $10\%$.

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSphFlexErrConv_SE_vs_error.eps}
\caption{Effect of proper motion uncertainties $\delta \mu$ on the precision of potential parameter recovery for two stellar populations of different kinematic temperature (see Test \ref{test:isoSphFlexErrConv_SE_vs_error} in Table \ref{tbl:tests} for all model parameters). The relative standard error (SE) derived from the marginalized \pdf{} for each model parameter was determined for precise data sets without measurement uncertainties (solid lines, with dotted lines indicating the error) and for data sets affected by different proper motion uncertainties $\delta \mu$ and $\delta v_\text{los}=2~\text{km s}^{-1}$ (data points with error bars), but no uncertainties in position. The errors come from taking the mean over several data sets. \Wilma{[TO DO: Find out where the typical GAIA threshold is and draw vertical line. Comment on this in the caption as well.]}}
\label{fig:isoSphFlexErrConv_SE_vs_error}
\end{figure}
%====================

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSphFlexErrConv_bias_vs_SE.eps}
\caption{Potential parameter recovery using the approximation for the model probability convolved with measurement uncertainties in Equation \eqref{eq:errorconv}. We show  \pdf{} offset and relative width (i.e., standard error SE) for potential parameters recovered from mock data sets (which were created according to Test \ref{test:isoSphFlexErrConv_bias_vs_SE} in Table \ref{tbl:tests}). The data sets in the upper panels are affected only by proper motion uncertainties $\delta \mu$ (and $\delta v_\text{los}=2~\text{mas yr}^{-1}$), while the data sets in the lower panels also have distance (modulus) uncertainties $\delta (m-M)$, as indicated in the legend. For data sets with $\delta \mu \leq 3 ~\text{mas yr}^{-1}$ Equation \eqref{eq:errorconv} was evaluated with $N_\text{samples}=800$, for $\delta \mu > 3~\text{mas yr}^{-1}$ we used $N_\text{samples}=1200$. In absence of distance uncertainties Equation \eqref{eq:errorconv} gives unbiased results. For $\delta(m-M) > 0.2~\text{mag}$ (i.e., $\delta r/r > 0.1$; for $r \sim 3~\text{kpc}$) however biases of several $\sigma$ are introduced, as Equation \eqref{eq:errorconv} is only an approximation for the true likelihood in this case. \Wilma{[TO DO: Find out where the typical GAIA threshold is and draw vertical line. Comment on this in the caption as well.]}}
\label{fig:isoSphFlexErrConv_bias_vs_SE}
\end{figure}
%====================

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSphFlexErrSyst_offset_vs_error.eps}
\caption{Effect of a systematic underestimation of proper motion uncertainties $\delta \mu$ on the recovery of the model parameters. (The true model parameters used to create the mock data are summarized as Test \ref{test:isoSphFlexErrSyst} in Table \ref{tbl:tests}, four of them are indicated as black dotted lines in this figure.) The mock data was perturbed according to proper motion uncertainties $\delta \mu = \delta \mu_\text{Dec} = \delta \mu_\text{RA}$ as indicated on the $x$-axis. In the \RM{} analysis (see likelihood in Equation \eqref{eq:errorconv}) however, we underestimated the true $\delta \mu$ by 10\% (circles) and 50\% (triangles). The symbols denote the \OLD{pest} \NEW{best} fit parameters with $1\sigma$ error bars of several mock data sets. The lines connect the mean of corresponding data realisations to guide the eye. \Wilma{[TO DO: Find out where the typical GAIA threshold is and draw vertical line. Comment on this in the caption as well.]}}
\label{fig:isoSphFlexErrSyst}
\end{figure}
%====================

We therefore found that in case we perfectly know the measurement uncertainties (and the distance uncertainty is negligible), the convolution of the model probability with the measurement uncertainties gives \emph{precise and accurate} constraints on the model parameters---even if the measurement uncertainty itself is quite large.

Lastly, Figure \ref{fig:isoSphFlexErrSyst} investigates the effect of a systematic \emph{underestimation} of the true proper motion uncertainties $\delta \mu$ by 10\% and 50\% (see also Test \ref{test:isoSphFlexErrSyst} in Table \ref{tbl:tests}). We find that this causes a bias in the parameter recovery that grows seemingly linear with $\delta \mu$. For an underestimation of only $10\%$ however, the bias is still $\lesssim 2 \sigma$ for 10,000 stars---even for $\delta \mu \sim 3~\text{mas yr}^{-1}$.

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/isoSphFlexMix_mockdata_residuals_3.eps}
\caption{Distribution of mock data $v_T$ and $v_z$ created by mixing stars drawn from two different qDFs (solid lines), and the distribution predicted by the best fit of a single qDF and potential to the data (dotted lines). (The model parameters used to create the mock data are given in Table \ref{tbl:tests} as Test \ref{test:isoSphFlexMix}, \emph{Example 1 \& 2a}, with the qDF parameters \OLD{refereed} \NEW{referred} to in the legend given in Table \ref{tbl:referenceMAPs}.) The corresponding single qDF best-fit curves were derived from the best fit parameters found in Figures \ref{fig:isoSphFlexMixCont} and \ref{fig:isoSphFlexMixDiff}. (The data sets are colour-coded in the same way as the corresponding analyses in Figures  \ref{fig:isoSphFlexMixCont} and \ref{fig:isoSphFlexMixDiff}.) We use the mixtures of two qDFs to demonstrate how \RM{} behaves for data sets following DFs with shapes slightly differing from a single qDF. For large deviations it might already become visible from directly comparing the mock data and best fit distribution, that a single qDF is a bad assumption for the stars' true DF. \HW{[TO DO: The referee writes: "it would be interesting to see the difference between the fits and the truth. Do the fits break down in particular places?"]}}
\label{fig:isoSphFlexMix_mockdata_residuals}
\end{figure}
%====================

The size of the bias also depends on the kinematic temperature of the stellar population and the model parameter considered (see Figure \ref{fig:isoSphFlexErrSyst}). The qDF parameters are for example better recovered by hotter populations. This is, because the relative difference between the \emph{true} $\sigma_i(R)$ (with $i \in \{R,z\}$) and \emph{measured} $\sigma_i(R)$ (which comes from the deconvolution with an underestimated velocity uncertainty) is smaller for hotter populations. 
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{The impact of deviations of the data from the idealized distribution function} \label{sec:results_mixedDFs}

\Wilma{[TO DO: The referee writes: "I think this and section 3.6 are the most valuable in the paper as they really explore potential systematics. In my opinion, these are the key results."]}

Our modelling approach assumes that each stellar population follows a simple DF; here we use the qDF. In this section we explore what happens if this idealization does not hold. We investigate this issue by creating mock data sets that are drawn from \emph{two} distinct qDFs of different temperature\footnote{Following the observational evidence, our mock data populations with cooler qDFs also have longer tracer scale lengths.} (see Table \ref{tbl:referenceMAPs} and Test \ref{test:isoSphFlexMix} in Table \ref{tbl:tests}), and analyse the composite mock data set by fitting a \emph{single} qDF to it. Some mock data sets and their best fit qDFs are illustrated in Figure \ref{fig:isoSphFlexMix_mockdata_residuals}, and the comparison of input and best fit parameters in Figures \ref{fig:isoSphFlexMixCont} and \ref{fig:isoSphFlexMixDiff}. In \emph{Example 1} we choose qDFs of widely different temperature and vary their relative fraction of stars in the composite mock data set (Figure \ref{fig:isoSphFlexMixCont}); in \emph{Example 2} we always mix mock data stars from two different qDFs in equal proportion, but vary by how much the qDFs' temperatures differ (Figure \ref{fig:isoSphFlexMixDiff}). 

The first set of tests mimics a DF that has wider wings or a sharper core in velocity space than a qDF (see Figure \ref{fig:isoSphFlexMix_mockdata_residuals}). The second test could be understood as mixing neighbouring \MAPs{} in the $[\alpha/\mathrm{Fe}]$-vs.-$[\mathrm{Fe}/\mathrm{H}]$ plane due to large bin sizes or abundance measurement errors (cf. BR13). 

We consider the impact of the DF deviations on the recovery of the potential and of the qDF parameters separately. 

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[scale=0.55]{figs/isoSphFlexMixCont_violins_2.eps}
\caption{The dependence of the parameter recovery on degree of pollution and temperature of the stellar population. We mix (i.e., ``pollute'') varying amounts of stars from a \texttt{hot} stellar population with stars from a very different \texttt{cooler} population (see Table \ref{tbl:referenceMAPs}), as indicated on the $x$-axis. (All model parameters used to create the mock data are given as Test \ref{test:isoSphFlexMix}, \emph{Example 1}, in Table \ref{tbl:tests}.) The composite polluted mock data set follows a true DF that has a slightly different shape than the qDF. We then analyse it using \RM{} and fit a \emph{single} qDF only. The violins represent the marginalized \pdf{}s for the best fit model parameters.  Some mock data sets are shown in Figure \ref{fig:isoSphFlexMix_mockdata_residuals}, first row, in the same colours as the violins here.  We find that a hot population is much less affected by pollution with stars from a cooler population than vice versa.}
\label{fig:isoSphFlexMixCont}
\end{figure}
%====================

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[scale=0.55]{figs/isoSphFlexMixDiff_violins_2.eps}
\caption{The dependence of the parameter recovery on the difference in qDF parameters of a 50/50 mixture of two stellar populations and their temperature. The two qDFs from which the stars in each mock data set were drawn are indicated in the legend, with the qDF parameters $\sigma_{R,0}, \sigma_{z,0}$ and $h_R$ differing by $X\%$ (see also Table \ref{tbl:referenceMAPs}), as indicated on the $x$-axis. (The model parameters used for the mock data creation are given as Test \ref{test:isoSphFlexMix}, \emph{Example 2a \& b}, in Table \ref{tbl:tests}.) Each composite mock data set is fitted with a \emph{single} qDF and the marginalized \pdf{}s are shown as violins. Some mock data sets of Example 2a are shown in Figure \ref{fig:isoSphFlexMix_mockdata_residuals}, last row (colour-coded analogous to the violins here). By mixing populations with varying difference in their qDF parameters, we model the effect of finite bin size or abundance errors when sorting stars into different \MAPs{} in the $[\alpha/\mathrm{Fe}]$-vs.-$[\mathrm{Fe}/\mathrm{H}]$ plane and assuming they follow single qDFs (cf. BR13). We find that the bin sizes should be chosen such that the difference in qDF parameters between neighbouring \MAPs{} is less than 20\%.} 
\label{fig:isoSphFlexMixDiff}
\end{figure}
%====================

We find from \emph{Example 1} that the potential parameters can be more robustly recovered, if a mock data population is polluted by a modest fraction ($\lesssim 30\%$) of stars drawn from a much cooler qDF, as opposed to the same pollution of stars from a hotter qDF. When considering the case of a 50/50 mix of contributions from different qDFs in \emph{Example 2}, there is a systematic, but mostly small, bias in recovering the potential parameters, monotonically increasing with the qDF parameter difference. In particular for fractional differences in the qDF parameters of $\lesssim 20\%$ the systematics are insignificant even for sample sizes of $N_{*} = 20,000$, as used in the mock data.

Overall, the circular velocity at the \OLD{sun} \NEW{Sun} is very reliably recovered to within $2\%$ in all these tests. But the best fit $v_\text{circ}(R_\odot)$ is not always unbiased at the implied precision.

%====================
\begin{figure}[!htbp]
\centering
\includegraphics[width=\columnwidth]{figs/MW14vsKKS2SphFlex_mockdata_residuals_3.eps}
\caption{Comparison of the distribution of mock data $v_T$ and $v_z$ created in the \texttt{MW14-Pot} potential and with two different stellar populations (see Test \ref{test:MW14vsKKS2SphFlex} in Table \ref{tbl:tests} for all mock data model parameters), and the best fit distribution recovered by fitting the family of \texttt{KKS-Pot} potentials to the data. The best fit potentials are shown in Figure \ref{fig:MW14vsKKS2SphFlex} and the corresponding best fit qDF parameters in Figure \ref{fig:MW14vsKKS2SphFlex_violins}. The data is very well recovered, even though the fitted potential family did not incorporate the true potential.}
\label{fig:MW14vsKKS2SphFlex_mockdata_residuals}
\end{figure}
%====================

%====================
\begin{figure*}[!htbp]
\centering
\includegraphics[width=0.7\textwidth]{figs/MW14vsKKS2SphFlex_contours_compare.eps}
\caption{Recovery of the gravitational potential if the assumed potential model family (\texttt{KKS-Pot} with fixed $v_\text{circ}(R_\odot)$) and the true potential of the (mock data) stars (\texttt{MW14-Pot} in Table \ref{tbl:referencepotentials}) have slightly different parametric forms. We show the circular velocity curve, as well as contours of equal density, radial and vertical force in the $R$-$z$-plane, and compare the true potential (black lines) with 100 sample potentials (red and blue lines) drawn from the \pdf{} found with MCMC for a \texttt{hot} (red) and a \texttt{cool} (blue) stellar population. (All mock data model parameters are given as Test \ref{test:MW14vsKKS2SphFlex} in Table \ref{tbl:tests}.) Overall, the true potential is well recovered. \HW{[TO DO: The referee writes: "Fig 19 is difficult to interpret. Is it possible to display the difference?"]}}
\label{fig:MW14vsKKS2SphFlex}
\end{figure*}
%====================

The recovery of the effective qDF parameters, in light of non-qDF mock data, is quite intuitive (in Figures \ref{fig:isoSphFlexMixCont} and \ref{fig:isoSphFlexMixDiff} we therefore show only $h_R$): the effective qDF temperature lies between the two temperatures from which the mixed DF of the mock data was drawn; in all cases the scale lengths of the velocity dispersion fall-off, $h_{\sigma,R}$ and $h_{\sigma,z}$, are shorter than the true scale lengths, because the stars drawn form the hotter qDF dominate at small radii, while stars from the cooler qDF (with its longer tracer scale length) dominate at large radii; the recovered tracer scale lengths, $h_R$, vary smoothly between the input values of the two qDFs that entered the mix of mock data, with again the impact of contamination by a hotter qDF (with its shorter scale length in this case) being more important. 

We note, that in the cases where the systematic bias in the potential parameter recovery becomes several $\sigma$ large, a direct comparison of the true mock data set and best fit distribution (see Figure \ref{fig:isoSphFlexMix_mockdata_residuals}) can sometimes already reveal that the assumed DF is not a good model for the data.

Overall, we find that the potential inference is quite robust to modest deviations of the data from the assumed DF. 
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{The implications of a gravitational potential not from the space of model potentials} \label{sec:results_potential}

We now explore what happens when the mock data were drawn from one axisymmetric potential family, here \texttt{MW14-Pot}, and is then modelled considering potentials from another axisymmetric family, here \texttt{KKS-Pot} (see Table \ref{tbl:referencepotentials} and Figure \ref{fig:ref_pots}). In the analysis we assume the circular velocity at the Sun to be fixed and known and only fit the parametric potential form.\footnote{We made sure that $v_\text{circ}(R_\odot)$ can be very well recovered when included in the fit of a \texttt{cool} population. The model assumption that $v_\text{circ}(R_\odot)$ is known does therefore not affect the discussion qualitatively.}

We analyse a mock data set from a \texttt{hot} and \texttt{cool} stellar population each (see Test \ref{test:MW14vsKKS2SphFlex} in Table \ref{tbl:tests}) with high numerical accuracy. The distributions generated from the best fit parameters reproduce the data in configuration space very well (see Figure \ref{fig:MW14vsKKS2SphFlex_mockdata_residuals}).

The results for the potential are shown in Figure \ref{fig:MW14vsKKS2SphFlex}. We find that the potential recovered by \RM{} is in good agreement with the true potential. Especially the force contours, to which the orbits are sensitive, and the rotation curve are very tightly constrained and reproduce the true potential even outside of the observed volume of the mock tracers.

%====================
\begin{figure*}[!htb]
\plotone{figs/MW14vsKKS2SphFlex_violins.eps}
\caption{Recovery of the qDF parameters for the case where the true and assumed potential deviate from each other (see Test \ref{test:MW14vsKKS2SphFlex} in Table \ref{tbl:tests}). The thick red (blue) lines represent the true qDF parameters of the \texttt{hot} (\texttt{cool}) qDF in Table \ref{tbl:referenceMAPs} used to create the mock data, surrounded by a 10\% error region. The grey violins are the marginalized \pdf{}s for the qDF parameters found simultaneously with the potential constraints shown in Figure \ref{fig:MW14vsKKS2SphFlex}. \HW{[TO DO: I think Fig. 20 could be removed. As mentioned it doesn't make sense to compare the DF parameters between different potentials so I am not sure what Fig 20 is telling us.]}}
\label{fig:MW14vsKKS2SphFlex_violins}
\end{figure*}
%====================

Overplotted in Figure \ref{fig:MW14vsKKS2SphFlex} is also the \texttt{KKS-Pot} with the parameters from Table \ref{tbl:referencepotentials}, which were fixed based on a (by-eye) fit \emph{directly} to the force field (within $r_\text{max}=4~\text{kpc}$ from the Sun) and rotation curve of the \texttt{MW14-Pot}. The potential found with the \RM{} analysis is an equally good or even slightly better fit. This demonstrates that \RM{} fitting infers a potential that in its actual properties resembles the input potential for the mock data as closely as possible, given the differences in functional forms.

The density contours are less tightly constrained than the forces, but we still capture the essentials. Overall the best fit disk is less dense in the midplane than the true disk. While it is in general possible to generate very flattened density distributions from St\"{a}ckel potentials, it might be difficult to simultaneously have a roundish halo and to require that both St\"{a}ckel components have the same focal distance (see Table \ref{tbl:referencepotentials}).

Figure \ref{fig:MW14vsKKS2SphFlex_violins} compares the true qDF parameters with the best fit qDF parameters belonging to the best fit potentials from Figure \ref{fig:MW14vsKKS2SphFlex}. While we recover $h_R$, $\sigma_{R,0}$ and $h_{\sigma,R}$ within the errors, we misjudge the parameters of the vertical velocity dispersion ($\sigma_{0,z}$ and $h_{\sigma,z}$), even though the actual mock data distribution is well reproduced. This discrepancy could be connected to the \texttt{KKS-Pot} not being able to reproduce the flatness of the disk. Also, $\sigma_z$ and $\sigma_R$ in Equations \eqref{eq:sigmaRRg}-\eqref{eq:sigmazRg} are scaling profiles for the qDF (cf. BR13) and how close they are to the actual velocity profile depends on the choice of potential; that is, the \emph{physical} velocity dispersion is well recovered, even if the velocity-dispersion parameter is not.

\Wilma{[TO DO: The fact the density is not well recovered seems interesting as it points to possible biases in the surface density of the disc/dark matter measurements if one uses the wrong potential. \HW{It would be good to have the discreapncy quantized in the text.}]}
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{The influence of the stellar population's kinematic temperature} \label{sec:results_temperature}

\HW{[TO DO: The referee writes: "Should this section be moved to the discussion section?"]}

Overall, we found that it does not make a big difference if we use hot or cool stellar populations in our modelling.

How precise and reliable model parameters can be recovered does to a certain extent depend on the kinematic temperature of the data, as well as on the model parameter in question and on the observation volume. But there is no easy rule of thumb, what combination would give the best results (see Figure \ref{fig:isoSph_CLT}). There are two exceptions.

First, the circular velocity at the Sun, $v_\text{circ}(R_\odot)$, is always best recovered with cooler populations (see Figures \ref{fig:isoSphFlexErrConv_SE_vs_error}, \ref{fig:isoSphFlexErrSyst}, \ref{fig:isoSphFlexMixCont}, \ref{fig:isoSphFlexMixDiff} and \ref{fig:MW14vsKKS2SphFlex}), because more stars are on near-circular orbits (see Figure \ref{fig:kks2WedgeEx_actions}). As cooler populations probe the rotation curve better, which in turn probes the gravitational potential, the potential recovery using cool stellar populations is less sensitive to misjudgements of (spatial) selection functions (see Figures \ref{fig:isoSphFlexIncompR_violins} and \ref{fig:isoSphFlexIncompR_marginal_violins}). There is however the caveat, that cool populations are more susceptible to non-axisymmetric streaming motions in the disk.

Second, hotter populations seem to be less sensitive to misjudgements of proper motion measurement uncertainties (see Figure \ref{fig:isoSphFlexErrSyst}) and pollution with stars from a cooler population (see Figures \ref{fig:isoSphFlexMixCont} and \ref{fig:isoSphFlexMixDiff}), because of their higher intrinsic velocity dispersion (see Figure \ref{fig:kks2WedgeEx_xv}).

In addition we found indications in Figure \ref{fig:MW14vsKKS2SphFlex}, that different regions within the Galaxy are probed best by populations of different kinematic temperature: The \texttt{hot} stellar population, with more stars reaching to high $|z|$ and a shorter tracer scale length, constrained force and density contours in the halo better---especially at smaller radii; the \texttt{cool} population, with more stars in the plane and longer tracer scale length, gave tighter force and density constraints in the outer regions of the halo and recovered the disk more reliably.
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% SUMMARY AND DISCUSSION
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Summary and discussion} \label{sec:discussionsummary}

Recently, implementations of action DF-based modelling of 6D data in the Galactic disk have been put forth, in part to lay the ground-work for Gaia (BR13; \citealt{,2013MNRAS.433.1411M,2014MNRAS.445.3133P,2015MNRAS.449.3479S}).

We present \RM{}, an improved implementation of the dynamical modelling machinery of BR13, to recover the MW's gravitational potential by fitting an orbit DF to stellar populations within the Galactic disk. In this work we investigated the capabilities, strengths and weaknesses of \RM{} by testing its robustness against the breakdown of some of its assumptions---for well-defined, isolated test cases using mock data. Overall the method works very well and is robust, even when there are small deviations of the model assumptions from the ``real world'' Galaxy.

\RM{} applies a full likelihood analysis and is statistically well-behaved. It goes beyond BR13 by allowing for a straightforward and flexible implementation of different model families for potential and DF. It also accounts for selection effects by using full 3D selection functions (given some symmetries).\\

\noindent {\bf Computational speed:~} Large data sets in the age of Gaia require increasingly accurate likelihood evaluations and flexible models. To be able to deal with these computational demands, we sped up the \RM{} code by combining a nested-grid approach with MCMC and by faster action calculation using the St\"{a}ckel \citep{2012MNRAS.426.1324B} interpolation grid by \citet{2015ApJS..216...29B}. However, application of \RM{} to millions of stars will still be a task for supercomputers and calls for even more improvements and speed-up in the fitting machinery.\\

\noindent {\bf Properties of the data set:~} We could show that \RM{} can provide potential and DF parameter estimates that are very accurate (i.e., unbiased) and precise in the limit of large datasets, as long as the modelling assumptions are fulfilled.

In case the data set is affected by substantive measurement uncertainties, the potential can still be recovered to high precision, as long as these uncertainties are perfectly known and distance uncertainties are negligible. For large proper motion uncertainties, e.g., $\delta \mu \sim 5~\text{mas yr}^{-1}$, the formal errors on the parameters are only twice as large as in the case of no measurement uncertainties. However, properly accounting for measurement uncertainties is computationally expensive.

For the results to be accurate within $2\sigma$ (for 10,000 stars), we need to know to within 10\% both the true stellar distances (at $r_\text{max} \leq 3~\text{kpc}$ and $\delta \mu \lesssim 2 ~ \text{mas yr}^{-1}$) and the true proper motion uncertainties (with $\delta \mu \lesssim 3 ~ \text{mas yr}^{-1}$).

\Wilma{[TO DO: Perhaps add statements comparing the errors explored to those anticipated from Gaia.]}

We also found that the location of the survey volume within the Galaxy matters little. At given sample size a larger survey volume with large coverage in both radial and vertical direction will give the tightest constraints on the model parameters.

Surprisingly (cf. \citealt{2013A&ARv..21...61R}), the potential recovery with \RM{} seems to be very robust against misjudgements of the spatial data SF. We speculate that this is because missing stars in the data set do not affect the measured rotation curve, which contains information about the potential.

We found indications that populations of different scale lengths and temperature probe different regions of the Galaxy best. This supports the approach by BR13, who constrained for each \MAP{} the surface mass density only at one single best radius to account for missing flexibility in their potential model. While cooler populations probe the Galaxy rotation curve better and hotter populations are less sensitive to pollution, overall stellar populations of different kinematic temperature seem to be equally well-suited for dynamical modelling.\\

\noindent {\bf Deviations from the DF assumption:~} \RM{} assumes that stellar sub-populations can be described by simple DFs. We investigated how much the modelling would be affected if the assumed family of DFs would differ from the stars' true DF.

In Example 1 in Section \ref{sec:results_mixedDFs} we considered true stellar DFs being (i) hot with more stars with low velocities and less stars at small radii than assumed (reddish data sets in Figure \ref{fig:isoSphFlexMix_mockdata_residuals} and \ref{fig:isoSphFlexMixCont}), or (ii) cool with broader velocity dispersion wings and less stars at large radii than assumed (bluish data sets). We find that case (i) would give more reliable results for the potential parameter recovery.

Binning of stars into \MAPs{} in $[\alpha/\mathrm{Fe}]$ and $[\mathrm{Fe}/\mathrm{H}]$, as done by BR13, could introduce systematic errors due to abundance uncertainties or too large bin sizes---always assuming \MAPs{} follow simple DF families (e.g., the qDF). In Example 2 in Section \ref{sec:results_mixedDFs} we found that, in the case of 20,000 stars per bin, differences of $\lesssim 20\%$ in the qDF parameters of two neighbouring bins can still give quite good constraints on the potential parameters.

The relative differences in the qDF parameters $\sigma_{R,0}$ and $\sigma_{z,0}$ of neighbouring \MAPs{} in Figure 6 of BR13 (which have bin sizes of $[\mathrm{Fe}/\mathrm{H}] = 0.1$ dex and $\Delta [\alpha/\mathrm{Fe}] = 0.05$ dex) are indeed smaller than $20\%$. Figure \ref{fig:isoSphFlexMixCont} and \ref{fig:isoSphFlexMixDiff} suggest that especially the tracer scale length $h_R$ needs to be recovered to get the potential scale length right. For this parameter however the bin sizes in Figure 6 of BR13 might not yet be small enough to ensure no more than $20\%$ of difference in neighbouring $h_R$.

The qDF is a specific example for a simple DF for stellar sub-populations which we used in this paper. But it is not essential for the \RM{} approach. Future studies might apply slight alternatives or completely different DFs to data.\\

\noindent {\bf Gravitational potential beyond the parametrized functions considered:~} In addition to the DF, \RM{} also assumes a parametric model for the gravitational potential. We test how using a potential of St\"{a}ckel form (\texttt{KKS-Pot}, \citealt{1994AA...287...43B}) affects the \RM{} analysis of mock data from a different potential family with halo, bulge and exponential disk. The potential recovery is quite successful: We properly reproduce the mock data distribution in configuration space; and the best fit potential is---within the limits of the model---as close as it gets to the true potential, even outside of the observation volume of the stellar tracers. 

For as many as 20,000 stars constraints become already so tight that it should presumably be possible to distinguish between different parametric MW potential models (e.g., the \texttt{MW13-Pot} used by BR13 and the \texttt{KKS-Pot}).

BR13 fitted a MW-like model potential and calculated actions using the St\"{a}ckel approximation \citep{2012MNRAS.426.1324B}; in this case study we directly fitted a St\"{a}ckel potential to the data, with exact actions in the model potential. The latter is computationally much less expensive due to the simple analytic form of the potential. It would also allow flexibility by expressing the MW potential as a superposition of many more simple Kuzmin-Kutuzov St\"{a}ckel components (\citet{2003MNRAS.340..752F} used for example 3 components). The former approach by BR13 however allows to parametrize the potential with intuitive and physically motivated building blocks (exponential disks, power-law dark matter halo etc.). While both approaches are formally similar, it remains to decide which is better.\\

\Wilma{[TO DO: The two approaches mentioned at the end of 'Gravitational potential beyond the...' are stated as formally similar but I think it is clear that one is better than the other. The true Staeckel approach limits you to potentials with the same foci. This is an obvious limitation and has been discussed before.]}

\Jo{[TO DO: We use the Staeckel Fudge with fixed focal length for all orbits. Or am I mistaken? The Staeckel Fudge as presented in Sanders \& Binney (2015) calculates a good focus for each orbit separately. Or is the galpy code doing that as well?]}

\noindent {\bf Different modelling approaches using action-based DFs:~} BR13 focussed on \MAPs{} for a number of reasons: First, they seem to permit simple DFs \citep{2012ApJ...751..131B,2012ApJ...755..115B,2012ApJ...753..148B}, i.e., approximately qDFs \citep{2013MNRAS.434..652T}. Second, all stars must orbit in the same potential. While each \MAP{} can yield different DF parameters, it will also provide a (statistically) independent estimate of the potential. This allows for a valuable cross-checking reference. In some sense, the \RM{} approach focusses on constraining the potential, treating the DF parameters as nuisance parameters. That we were able to show in this work that \RM{} results are quite robust to the form of the DF not being entirely correct motivates this approach further. 

For reasons of galaxy and chemical evolution, the DF properties are astrophysically linked between different \MAPs{} \citep{2015MNRAS.449.3479S}. In its current implementation, \RM{} treats all \MAPs{} as independent and dos not exploit such correlations. Ultimately, the goal is to do a consistent chemodynamical model that simultaneously fits the potential and $\text{DF}(\vect{J},\text{[X/H]})$ (where $[\mathrm{X}/\mathrm{Fe}]$ denotes the whole abundance space) with a full likelihood analysis. This has not yet been attempted with \RM{}, because the behaviour is quite complex. 

\HW{[TO DO: The referee writes: "The definition of X in f(J,[X/H]) doesn't seem to make sense."]}

Since the first application of \RM{} by BR13 there have been two similar efforts to constrain the Galactic potential and/or orbit DF:

\citet{2014MNRAS.445.3133P} fitted both potential and a $f(\vect{J})$ to giant stars from the RAVE survey \citep{2006AJ....132.1645S} and the vertical stellar number density profiles in the disk by \citet{2008ApJ...673..864J}. They did not include any chemical abundances in the modelling. Instead, they used a superposition of action-based DFs to describe the overall stellar distribution at once: a superposition of qDFs for cohorts in the thin disk, a single qDF for the thick disk stars and an additional DF for the halo stars. Taking proper care of the selection function requires a full likelihood analysis, which is computationally expensive. \citet{2014MNRAS.445.3133P} choose to circumvent this difficulty by directly fitting a) histograms of the three velocity components in eight spatial bins to the velocity distribution predicted by the DF and b) the vertical density profile predicted by the DF to the profiles by \citet{2008ApJ...673..864J}. The vertical force profile of their best fit mass model nicely agrees with the results from BR13 for $R>6.6~\text{kpc}$. The disadvantage of their approach is, that by binning the stars spatially, a lot of information is not used.

\citet{2015MNRAS.449.3479S} have focussed on understanding the abundance-dependence of the DF, relying on a fiducial potential. They developed extended distribution functions (eDF), i.e., functions of both actions and metallicity for a superposition of thin and thick disk, each consisting of several cohorts described by qDFs, a DF for the halo, a functional form of the metallicity of the interstellar medium at the time of birth of the stars, and a simple prescription for radial migration. They applied a full likelihood analysis accounting for selection effects and found a best fit for the eDF in the fixed fiducial potential by \citet{1998MNRAS.294..429D} to the stellar phase-space data of the Geneva-Copenhagen Survey \citep{2004A&A...418..989N,2009A&A...501..941H}, metallicity determinations by \citet{2011A&A...530A.138C} and the stellar density curves by \citet{1983MNRAS.202.1025G}. Their best fit predicted the velocity distribution of SEGUE G-dwarfs \citep{2014ApJS..211...17A} quite well, but had biases in the metallicity distribution, which they accounted to being a problem with the SEGUE metallicities. \\

\noindent {\bf Future work:~} We know that real galaxies, including the MW, are not axisymmetric. Using N-body models, we will explore in a subsequent paper how the recovery of the gravitational potential with \RM{} will be affected when data from a non-axisymmetric system get interpreted through axisymmetric models. In this context further investigations of questions that came up in Section \ref{sec:results_incompR} (``How much of the information on the potential is stored in the rotation curve?'') and earlier in Section \ref{sec:discussionsummary} (``What is better: fitting a MW-like potential using approximate St\"ackel actions, or fitting a St\"ackel potential to the MW using exact actions?'') should also be conducted.

\Wilma{[TO DO: The first section in future work is very interesting. \HW{Use of different DFs and potentials as explored in this paper is interesting but a true test of the apparatus on a more realistic galaxy} would make the 'RoadMapping' tool much more attractive.]}

\Wilma{[TO DO: I think that the final two questions of the future work section are weak. Clearly the rotation curve is only describing the in-plane force not the force everywhere. Parametrizations will naturally convince you that the rotation curve is well measured but I think there is a lot more flexibility. Also, the advantage of using the approximate actions is that more realistic potentials can be considered.]}
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Acknowledgements}

We thank Glenn van de Ven for suggesting the use of Kuzmin-Kutuzov St\"{a}ckel potentials in this case study. We also thank James J. Binney and Payel Das (University of Oxford) for valuable discussions. W.H.T. and H.-W.R. acknowledge funding from the European  Research Council under the European Union's Seventh Framework Programme (FP 7) ERC Grant Agreement n. [321035]. J.B. acknowledges the financial support from the Natural Sciences and Engineering Research Council of Canada. 
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% REFERENCES
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\Wilma{[TO DO: Use appropriate journal abbreviations in the reference list.]}
\begin{thebibliography}{}
\bibitem[Ahn et al.(2014)]{2014ApJS..211...17A} Ahn, C.~P., Alexandroff, R., Allende Prieto, C., et al.\ 2014, \apjs, 211, 17 
\bibitem[Batsleer \& Dejonghe(1994)]{1994AA...287...43B} Batsleer, P., \& Dejonghe, H.\ 1994, \aap, 287, 43
\bibitem[Binney \& Tremaine(2008)]{2008gady.book.....B} Binney, J., \& Tremaine, S.\ 2008, Galactic Dynamics: Second Edition
\bibitem[Binney(2010)]{2010MNRAS.401.2318B} Binney, J.\ 2010, \mnras, 401, 2318
\bibitem[Binney(2011)]{2011Prama..77...39B} Binney, J.\ 2011, Pramana, 77, 39
\bibitem[Binney \& McMillan(2011)]{2011MNRAS.413.1889B} Binney, J., \& McMillan, P.\ 2011, \mnras, 413, 1889
\bibitem[Binney(2012a)]{2012MNRAS.426.1324B} Binney, J.\ 2012a, \mnras, 426, 1324
\bibitem[Binney(2012b)]{2012MNRAS.426.1328B} Binney, J.\ 2012b, \mnras, 426, 1328
\bibitem[Binney(2013)]{2013NewAR..57...29B} Binney, J.\ 2013, NAR, 57, 29 
\bibitem[Bovy et al.(2012b)]{2012ApJ...751..131B} Bovy, J., Rix, H.-W., \& Hogg, D.~W.\ 2012b, \apj, 751, 131
\bibitem[Bovy et al.(2012c)]{2012ApJ...755..115B} Bovy, J., Rix, H.-W., Hogg, D.~W., et al.\ 2012c, \apj, 755, 115 
\bibitem[Bovy et al.(2012d)]{2012ApJ...753..148B} Bovy, J., Rix, H.-W., Liu, C., et al.\ 2012d, \apj, 753, 148
\bibitem[Bovy \& Tremaine(2012)]{2012ApJ...756...89B} Bovy, J., \& Tremaine, S.\ 2012, \apj, 756, 89
\bibitem[Bovy \& Rix(2013)]{2013ApJ...779..115B} Bovy, J., \& Rix, H.-W.\ 2013, \apj, 779, 115 (BR13)
\bibitem[Bovy(2015)]{2015ApJS..216...29B} Bovy, J.\ 2015, \apjs, 216, 29
\bibitem[B{\"u}denbender et al.(2015)]{2015MNRAS.452..956B} B{\"u}denbender, A., van de Ven, G., \& Watkins, L.~L.\ 2015, \mnras, 452, 956 
\bibitem[Casagrande et al.(2011)]{2011A&A...530A.138C} Casagrande, L., Sch{\"o}nrich, R., Asplund, M., et al.\ 2011, \aap, 530, A138 
\bibitem[Dehnen \& Binney(1998)]{1998MNRAS.294..429D} Dehnen, W., \& Binney, J.\ 1998, \mnras, 294, 429 
\bibitem[de Lorenzi et al.(2007)]{2007MNRAS.376...71D} de Lorenzi, F., Debattista, V.~P., Gerhard, O., \& Sambhus, N.\ 2007, \mnras, 376, 71 
\bibitem[de Zeeuw(1985)]{1985MNRAS.216..273D} de Zeeuw, T.\ 1985, \mnras, 216, 273 
\bibitem[Famaey \& Dejonghe(2003)]{2003MNRAS.340..752F} Famaey, B., \& Dejonghe, H.\ 2003, \mnras, 340, 752 
\bibitem[Foreman-Mackey et al.(2013)]{2013PASP..125..306F} Foreman-Mackey, D., Hogg, D.~W., Lang, D., \& Goodman, J.\ 2013, \pasp, 125, 306
\bibitem[Garbari et al.(2012)]{2012MNRAS.425.1445G} Garbari, S., Liu, C., Read, J.~I., \& Lake, G.\ 2012, \mnras, 425, 1445 
\bibitem[Gilmore \& Reid(1983)]{1983MNRAS.202.1025G} Gilmore, G., \& Reid, N.\ 1983, \mnras, 202, 1025 
\bibitem[Henon(1959)]{1959AnAp...22..126H} Henon, M.\ 1959, Annales d'Astrophysique, 22, 126 
\bibitem[Holmberg et al.(2009)]{2009A&A...501..941H} Holmberg, J., Nordstr{\"o}m, B., \& Andersen, J.\ 2009, \aap, 501, 941 
\bibitem[Hunt \& Kawata(2014)]{2014MNRAS.443.2112H} Hunt, J.~A.~S., \& Kawata, D.\ 2014, \mnras, 443, 2112 
\bibitem[Juri{\'c} et al.(2008)]{2008ApJ...673..864J} Juri{\'c}, M., Ivezi{\'c}, {\v Z}., Brooks, A., et al.\ 2008, \apj, 673, 864
\bibitem[Kuijken \& Gilmore(1989)]{1989MNRAS.239..605K} Kuijken, K., \& Gilmore, G.\ 1989, \mnras, 239, 605 
\bibitem[McMillan \& Binney(2008)]{2008MNRAS.390..429M} McMillan, P.~J., \& Binney, J.~J.\ 2008, \mnras, 390, 429 
\bibitem[McMillan(2012)]{2012EPJWC..1910002M} McMillan, P.~J.\ 2012, European Physical Journal Web of Conferences, 19, 10002 
\bibitem[McMillan \& Binney(2012)]{2012MNRAS.419.2251M} McMillan, P.~J., \& Binney, J.\ 2012, \mnras, 419, 2251 
\bibitem[McMillan \& Binney(2013)]{2013MNRAS.433.1411M} McMillan, P.~J., \& Binney, J.~J.\ 2013, \mnras, 433, 1411
\bibitem[Nordstr{\"o}m et al.(2004)]{2004A&A...418..989N} Nordstr{\"o}m, B., Mayor, M., Andersen, J., et al.\ 2004, \aap, 418, 989 
\bibitem[Perryman et al.(2001)]{2001A&A...369..339P} Perryman, M.~A.~C., de Boer, K.~S., Gilmore, G., et al.\ 2001, \aap, 369, 339 
\bibitem[Piffl et al.(2014)]{2014MNRAS.445.3133P} Piffl, T., Binney, J., McMillan, P.~J., et al.\ 2014, \mnras, 445, 3133
\bibitem[Read(2014)]{2014JPhG...41f3101R} Read, J.~I.\ 2014, Journal of Physics G Nuclear Physics, 41, 063101 
\bibitem[Rix \& Bovy(2013)]{2013A&ARv..21...61R} Rix, H.-W., \& Bovy, J.\ 2013, \aapr, 21, 61
\bibitem[Sanders \& Binney(2015)]{2015MNRAS.449.3479S} Sanders, J.~L., \& Binney, J.\ 2015, \mnras, 449, 3479
\bibitem[Steinmetz et al.(2006)]{2006AJ....132.1645S} Steinmetz, M., Zwitter, T., Siebert, A., et al.\ 2006, \aj, 132, 1645 
\bibitem[Strigari(2013)]{2013PhR...531....1S} Strigari, L.~E.\ 2013, \physrep, 531, 1 
\bibitem[Syer \& Tremaine(1996)]{1996MNRAS.282..223S} Syer, D., \& Tremaine, S.\ 1996, \mnras, 282, 223 
\bibitem[Ting et al.(2013)]{2013MNRAS.434..652T} Ting, Y.-S., Rix, H.-W., Bovy, J., \& van de Ven, G.\ 2013, \mnras, 434, 652
\bibitem[Yanny et al.(2009)]{2009AJ....137.4377Y} Yanny, B., Rockosi, C., Newberg, H.~J., et al.\ 2009, \aj, 137, 4377 
\bibitem[Zhang et al.(2013)]{2013ApJ...772..108Z} Zhang, L., Rix, H.-W., van de Ven, G., et al.\ 2013, \apj, 772, 108
\end{thebibliography}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
% TABLE
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\clearpage
\LongTables
\begin{landscape}
\begin{deluxetable}{lllll}
\tabletypesize{\scriptsize}
\tablecaption{Summary of test suites in this work: The first column indicates the test suite, the second column the potential, DF and SF model, etc., used for the mock data creation, the third column the corresponding model assumed in the \RM{} analysis, and the last column lists the figures belonging to the test suite. Reference potentials and qDFs are introduced in Tables \ref{tbl:referencepotentials} and \ref{tbl:referenceMAPs}, respectively. Parameters that are not left free in the \OLD{analyis} \NEW{analysis}, are always fixed to their true value. Unless stated otherwise, all mock data sets have SFs with completeness$(\vect{x}) = 1$ and no measurement uncertainties. \Wilma{[TO DO: Can you add a summary column that summarizes the result? This would make the paper much more 'usable'.]} \label{tbl:tests}}
\tablewidth{0pt}
\tablehead{
\colhead{Test} & & \colhead{Model for Mock Data}  & \colhead{Model in Analysis} & \colhead{Figures}}
\startdata
Test \testlabel{test:norm_accuracy} {1}:         & \emph{Potential:}     & \texttt{KKS-Pot} & - & Figure \ref{fig:norm_accuracy}\\
Numerical accuracy      & \emph{DF:}          & \texttt{hot} qDF                          &   & \\
in calculating          & \emph{Survey volume:} & sphere around Sun, $r_\text{max} = 0.2, 1, 2, 3$ or $4~\text{kpc}$ &   & \\
the likelihood       & \emph{Numerical accuracy:} & $N_x\in[5,20]$, $N_v\in[6,40]$, $n_\sigma\in[3.5,7]$& & \\
normalisation           &                       & & & \\
\tableline
Test \testlabel{test:isoSphFlexErrConv_MC_vs_error}{2} :		& \emph{Potential:} 	& \texttt{Iso-Pot} & \texttt{Iso-Pot}, all parameters free & Figure \ref{fig:isoSphFlexErrConv_MC_vs_error}\\
Numerical convergence 	& \emph{DF:}			& \texttt{hot} qDF & qDF, all parameters free & \\
of convolution		& \emph{Survey Volume:}	& sphere around Sun, $r_\text{max} = 3~\text{kpc}$ & (fixed \& known) & \\
with measurement		& \emph{Uncertainties:}		& $\delta \text{RA} =\delta \text{Dec} =\delta(m-M)=0$	& (fixed \& known)	& \\
uncertainties					&						& $\delta v_\text{los} = 2~\text{km s}^{-1}$ &  & \\
						&						& $\delta \mu =$ 2,3,4 or $5~\text{mas yr}^{-1}$ & & \\
						& \emph{Numerical Accuracy:} & & $N_\text{samples} \in [25,1200]$& \\
						& \emph{$N_{*}$:} & 10,000 & & \\	   
\tableline
Test \testlabel{test:isoSphFlex} {3.1}:      & \emph{Potential:}     & \texttt{Iso-Pot} & \texttt{Iso-Pot}, all parameters free & Figure \ref{fig:isoSphFlex_triangleplot}\\
The \pdf{} is a               & \emph{DF:}          & \texttt{hot} qDF & qDF, all parameters free & \\
multivariate            & \emph{Survey Volume:} & sphere around Sun, $r_\text{max} = 2~\text{kpc}$ & (fixed \& known) & \\
Gaussian                & \emph{$N_{*}$:} & 20,000 & & \\
for large data sets.	&  & & & \\

\tableline
Test \testlabel{test:sqrtNiso} {3.2}:			& \emph{Potential:}     & \texttt{Iso-Pot} & \texttt{Iso-Pot}, free parameter: $b$ & Figure \ref{fig:sqrtNiso}\\
Width of the			& \emph{DF:}          & \texttt{hot} qDF & qDF, free parameters: & \\
likelihood scales       &                       &           & $\ln h_R,\ln\sigma_{R,0},\ln h_{\sigma,R}$ & \\
with number of stars    & \emph{Survey volume:} & sphere around Sun, $r_\text{max} = 3~\text{kpc}$   & (fixed \& known) & \\
by $\propto 1/\sqrt{N_{*}}$.& \emph{$N_{*}$:} & between 100 and 40,000 &  & \\
\tableline
Test \testlabel{test:isoSph_CLT} {3.3}:        & \emph{Potential:}     & \texttt{Iso-Pot} & \texttt{Iso-Pot}, free parameter: $b$ & Figure \ref{fig:isoSph_CLT}\\
Parameter estimates     & \emph{DF:}       &\texttt{hot} or \texttt{cool} qDF & qDF, free parameters:\\
are unbiased;           &          &    & $\ln h_R,\ln\sigma_{R,0},\ln h_{\sigma,R}$ & \\
Influence of survey & \emph{Survey volume:} & sphere around Sun, $r_\text{max} = 0.2, 1, 2, 3$ or $4~\text{kpc}$ & (fixed \& known) & \\
volume size & \emph{$N_{*}$:} & 20,000 & & \\
\tableline
Test \testlabel{test:wedFlexVol} {4} :		& \emph{Potential:} 	& (i) \texttt{Iso-Pot} or (ii) \texttt{MW13-Pot} & (i) \texttt{Iso-Pot}, all parameters free & Figure \ref{fig:wedFlexVol_bias_vs_SE} \\
Influence of 			& 						& 													& (ii) \texttt{MW13-Pot}, $R_d$ and $f_h$ free & \\
position \& shape 		& \emph{DF:}			& \texttt{hot} qDF 										& (i) qDF, all parameters free & \\
of survey volume 		& 						& 													& (ii) qDF, only $h_R$, $\sigma_{z,0}$ and $h_{\sigma,R}$ free& \\
on parameter recovery 	& \emph{Survey volume:}	& 4 different wedges, see Figure \ref{fig:wedFlexVol_bias_vs_SE}, upper panel & (fixed \& known) & \\
						& \emph{$N_{*}$:} & 20,000 & & \\
\tableline
Test \testlabel{test:isoSphFlexIncomp}{5} :        & \emph{Potential:}     & \texttt{Iso-Pot} & \texttt{Iso-Pot}, all parameters free & Figures \ref{fig:isoSphFlexIncompR_violins} \& \ref{fig:isoSphFlexIncompR_marginal_violins}\\
Influence of            & \emph{DF:}          & \texttt{hot} or \texttt{cool} qDF & qDF, all parameters free &   \\
wrong assumptions       & \emph{Survey volume:} & sphere around Sun, $r_\text{max} = 3~\text{kpc}$ & (fixed \& known) & \\
about the spatial SF     & \emph{Completeness:}  & Equation \eqref{eq:rad_incomp}   & completeness$(\vect{x})$ = 1, & \\
on parameter recovery       &                       &  with $\epsilon_r \in [0,0.7]$ & i.e., $\epsilon_r=0$& \\
   &   \emph{$N_{*}$:}                     & 20,000  & & \\
\tableline
Test \testlabel{test:isoSphFlexErrConv_SE_vs_error}{6.1} : & \emph{Potential:} & \texttt{Iso-Pot} & \texttt{Iso-Pot}, all parameters free & Figure \ref{fig:isoSphFlexErrConv_SE_vs_error}\\
Effect of proper motion & \emph{DF:} & \texttt{hot} or \texttt{cool} qDF & qDF, all parameters free & \\
uncertainties on & \emph{Survey volume:} & sphere around Sun, $r_\text{max} = 3~\text{kpc}$ & (fixed \& known) & \\
precision of & \emph{Uncertainties:} & (i) $\delta\text{RA}=\delta\text{Dec}=\delta(m-M)=0,$ & (fixed \& known) & \\
potential recovery & & $\delta v_\text{los} = 2~\text{km s}^{-1},$ & & \\
& & $\delta \mu = 1, 2, 3, 4$ or $5~\text{mas yr}^{-1}$ & & \\
& & (ii) no measurement uncertainties & & \\
 & \emph{$N_{*}$:} & 10,000 & & \\
\tableline
Test \testlabel{test:isoSphFlexErrConv_bias_vs_SE}{6.2} : & \emph{Potential:} 	& \texttt{Iso-Pot} & \texttt{Iso-Pot}, all parameters free & Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE}\\
Testing the	convolution		& \emph{DF:}			& \texttt{hot} qDF & qDF, all parameters free & \\
with measurement 		& \emph{Survey Volume:}	& sphere around Sun, $r_\text{max} = 3~\text{kpc}$ & (fixed \& known) & \\
 uncertainties in Equation \eqref{eq:errorconv}  & \emph{Uncertainties:}		& $\delta \text{RA} =\delta \text{Dec} =0$,	& (fixed \& known)	& \\
with \& without			&						& $\delta v_\text{los}  = 2~\text{km s}^{-1}$, & & \\
distance uncertainties						&						& $\delta \mu =$ 1,2,3,4 or $5~\text{mas yr}^{-1}$, & & \\
						&						& (i) $\delta(m-M) = 0$  or & &  \\
						&                     & (ii) $\delta(m-M) \neq 0$ (see Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE})  & & \\
						& \emph{$N_{*}$:} & 10,000 & & \\
\tableline
Test \testlabel{test:isoSphFlexErrSyst}{6.3} :	& \emph{Potential:}		& \texttt{Iso-Pot} & \texttt{Iso-Pot}, all parameters free & Figure \ref{fig:isoSphFlexErrSyst}\\
Underestimation 	& \emph{DF:}			& \texttt{hot} or \texttt{cool} qDF & qDF, all parameters free & \\
of proper motion 	& \emph{Survey volume:}	& sphere around Sun, $r_\text{max} = 3~\text{kpc}$ & (fixed \& known) & \\
uncertainties 			 	& \emph{Uncertainties:}		& only proper motion uncertainties & proper motion uncertainties & \\
					&						& 1, 2 or $3~\text{mas yr}^{-1}$ & 10\% or 50\% underestimated & \\
					& \emph{$N_{*}$:} & 10,000 & & \\
\tableline
Test \testlabel{test:isoSphFlexMix}{7} :       & \emph{Potential:} & \texttt{Iso-Pot} & \texttt{Iso-Pot}, all parameters free & Figures \ref{fig:isoSphFlexMix_mockdata_residuals}, \ref{fig:isoSphFlexMixCont} \& \ref{fig:isoSphFlexMixDiff}\\
Deviations of the       & \emph{DF:}      & mix of two qDFs... & single qDF, all parameters free & \\
assumed DF              &                   & (i) \emph{Example 1:}   & & \\
from the                &                   & ... with different mixing rates & & \\
stars' true DF          &                   & and fixed qDF parameters & & \\
                        &                   & (\texttt{hot} \& \texttt{cooler} qDF from Table \ref{tbl:referenceMAPs}) & & \\
                        &                   & \emph{Example 2:} & & \\
                        &                   & ... with 50/50 mixing rate & & \\
                        &                   & and varying qDF parameters (by $X\%$): & & \\
                        &                   & \emph{a)} \texttt{hot} \& \texttt{colder} qDF or & & \\
                        &					  & \emph{b)} \texttt{cool} \& \texttt{warmer} qDF (see Table \ref{tbl:referenceMAPs}) & & \\
                        & \emph{Survey volume:}& sphere around Sun, $r_\text{max}=2~\text{kpc}$ & (fixed \& known) & \\
                        & \emph{$N_{*}$:} & 20,000 & & \\
                        \tableline
Test \testlabel{test:MW14vsKKS2SphFlex}{8} :			&  \emph{Potential:} & \texttt{MW14-Pot} & \texttt{KKS-Pot}, all parameters free, & Figures \ref{fig:MW14vsKKS2SphFlex_mockdata_residuals}, \ref{fig:MW14vsKKS2SphFlex} \& \ref{fig:MW14vsKKS2SphFlex_violins}\\
Deviations of the		&                    &            & only $v_\text{circ}(R_\odot)=230~\text{km s}^{-1}$ fixed &  \\
assumed potential model	& \emph{DF:}       & \texttt{hot} or \texttt{cool} qDF & qDF, all parameters free & \\
from the stars'			& \emph{Survey volume:} & sphere around Sun, $r_\text{max} = 4~\text{kpc}$ & (fixed \& known) &  \\
true potential			& \emph{$N_{*}$:} & 20,000 & & \\
\enddata
\end{deluxetable}
\clearpage
\end{landscape}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\begin{appendix}

%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Mock data} \label{sec:mockdata}

\OLD{We will rely on mock data as input to explore the limitations of the modelling.} \NEW{The mock data in this work is generated according to the following procedure:} 

We assume that the positions and velocities of our stellar mock sample are indeed drawn from our assumed family of potentials \NEW{(Section \ref{sec:potentials})} and DFs \NEW{(Section \ref{sec:qDF}),} \OLD{(}with given parameters $p_\Phi$ and $p_\text{DF}$\OLD{)}. The DF is in terms of actions, while the transformation $(\vect{x}_i,\vect{v}_i) \stackrel{\Phi}{\longrightarrow} \vect{J}_i$ is computationally much less expensive than its inversion. We therefore employ the following efficient two-step method for creating mock data, which also accounts for a survey SF$(\vect{x})$.

In the first step we draw stellar positions $\vect{x}_i$. We start by setting up the interpolation grid for the tracer density $\rho(R,|z| \mid p_\Phi, p_\text{DF})$ generated according to Section \ref{sec:qDF}.\footnote{For the creation of the mock data we use $N_x = 20$, $N_v = 40$ and $n_\sigma=5$ in Equation \eqref{eq:tracerdensity}.} Next, we sample random positions $(R_i,z_i,\phi_i)$ uniformly within the observable volume. Using a Monte Carlo rejection method we then shape the samples distribution to follow $\rho(R,|z| \mid p_\Phi, p_\text{DF})$. To apply a non-uniform completeness function, we use the rejection method a second time. The resulting set of positions $\vect{x}_i$ follows the distribution $p(\vect{x}) \propto \rho_\text{DF}(R,|z| \mid p_{\Phi},p_\text{DF}) \times \text{SF}(\vect{x})$.

In the second step we draw velocities $\vect{v}_i$. For each of the positions $(R_i,z_i)$ we first sample velocities from a Gaussian envelope function in velocity space which is then shaped towards DF$(\vect{J}[R_i,z_i,\vect{v} \mid p_{\Phi}] \mid p_\text{DF})$ using a rejection method. We now have a mock data set satisfying $(\vect{x}_i,\vect{v}_i) \longrightarrow p(\vect{x},\vect{v}) \propto \text{DF}(\vect{J}[\vect{x},\vect{v} \mid p_{\Phi}] \mid p_\text{DF}) \times \text{SF}(\vect{x})$.

\HW{[TO DO: The referee wrote: "The discussion of selection on very errorneous x coordinates is interesting but surely this isn't the way the data will actually be handled?" - What does he mean? What's wrong?]}

Measurement uncertainties can be added to the mock data by applying the following modifications to the above procedure. We assume Gaussian uncertainties in the heliocentric phase-space coordinates $\tilde{\vect{x}} = (\text{RA},\text{Dec},(m-M)), \tilde{\vect{v}} = (\mu_\text{RA} \cdot \cos \text{Dec} ,\mu_\text{Dec},v_\text{los})$ (see Section \ref{sec:coordinates}). In the case of distance and position uncertainties stars virtually scatter in and out of the observed volume. To account for this, we draw the \emph{true} $\vect{x}_i$ from a volume that is larger than the actual observation volume, perturb the $\vect{x}_i$ according to the position uncertainties and then reject all stars that lie now outside of the observed volume. This mirrors the Poisson scatter around the detection threshold for stars whose distances are determined from the apparent brightness and the distance modulus. We then sample \emph{true} $\vect{v}_i$ (given the \emph{true} $\vect{x}_i$) as described above and perturb them according to the velocity uncertainties.

%====================
\begin{figure}[!htbp]
\centering
\begin{minipage}{0.48\textwidth}
\centering
\includegraphics[width=\textwidth]{figs/kks2WedgeEx_mockdata_actions.eps}
\caption{Distribution of mock data in action space (2D iso-density contours, enclosing 80\% of the stars), depending on shape and position of a wedge-like survey observation volume (upper left panel) and temperature of the stellar population (indicated in the legend). \OLD{The \pmodel{} of the mock data, created in the \texttt{KKS-Pot} potential, are given as Test 1 in Table 3.} \NEW{The four mock data sets are generated in the \texttt{KKS-Pot} from Table \ref{tbl:referencepotentials} from either the \texttt{hot} or \texttt{cool} DF in Table \ref{tbl:referenceMAPs}.} The distribution in action space visualizes how orbits with different actions reach into different regions within the Galaxy. The corresponding mock data in configuration space is shown in Figure \ref{fig:kks2WedgeEx_xv}.} 
\label{fig:kks2WedgeEx_actions}
\end{minipage}
\hfill
\begin{minipage}{0.48\textwidth}
\centering
\includegraphics[width=\textwidth]{figs/kks2WedgeEx_mockdata_xv.eps}
\caption{Distribution of the mock data from Figure \ref{fig:kks2WedgeEx_actions} in configuration space. The corresponding observation volumes (as indicated in the legend) are shown in Figure \ref{fig:kks2WedgeEx_actions}, upper left panel. The 1D histograms illustrate that qDFs generate realistic stellar distributions in Galactocentric coordinates $(R,z,\phi,v_R,v_z,vT)$: More stars are found at smaller $R$ and $|z|$, and are distributed uniformly in $\phi$ according to our assumption of axisymmetry. The distribution in radial and vertical velocities, $v_R$ and $v_z$, is approximately Gaussian with the (total projected) velocity dispersion being of the order of $\sim\sigma_{R,0}$ and $\sim\sigma_{z,0}$ (see Table \ref{tbl:referenceMAPs}). The distribution of tangential velocities $v_T$ is skewed because of asymmetric drift.} 
\label{fig:kks2WedgeEx_xv}
\end{minipage}
\end{figure}
%====================

We show examples of mock data sets (without measurement uncertainties) in action space (Figure \ref{fig:kks2WedgeEx_actions}) and configuration space $(\vect{x},\vect{v})$ (Figure \ref{fig:kks2WedgeEx_xv}). The mock data generated from the qDF follow the expected distributions in configuration space. The distribution in action space illustrates the intuitive physical meaning of actions: The stars of the \texttt{cool} population have in general lower radial and vertical actions, as they are on more circular orbits. Circular orbits with $J_R = 0$ and $J_z = 0$ can only be observed in the Galactic mid-plane. The different ranges of angular momentum $L_z$ in the two example observation volumes reflect $L_z \sim R  \times v_\text{circ}$ and the volumes' different radial extent. The volume at larger $z$ contains stars with higher $J_z$.  An orbit with $L_z \ll$ or $\gg L_z(R_\odot)$ can only reach into a volume at $\sim R_\odot$, if it is more eccentric and has therefore larger $J_R$. This together with the effect of asymmetric drift explains the asymmetric distribution of $J_R$ vs. $L_z$ in Figure \ref{fig:kks2WedgeEx_actions}.
%-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

\end{appendix}

\end{document}