%% Document class
\documentclass[12pt,preprint]{aastex}

%general packages
\usepackage{amsmath}	%for \text{} in math mode

%%Figure packages
\usepackage{grffile}	%for dots in filenames

 
%% Abbreviations
\shorttitle{Action-based Dynamical Models for the Milky Way}
\shortauthors{Trick et al.}

\begin{document}

%% Title
\title{Action-based Dynamical Models for the Milky Way Disk:\\
    How to deal with "Real World" Issues}

%% Authors    
\author{W. Trick\altaffilmark{1,2} and H.-W. Rix\altaffilmark{1}}
\affil{Max-Planck-Institute for Astronomy, Heidelberg}
\email{trick@mpia.de}
\and
\author{J. Bovy\altaffilmark{3,4}}
\affil{Institute for Advanced Study, Princeton, NJ}

%% Affiliations
\altaffiltext{1}{Max-Planck-Institut f\"ur Astronomie, K\"onigstuhl 17, D-69117 Heidelberg, Germany}
\altaffiltext{2}{Correspondence should be addressed to trick@mpia.de.}
\altaffiltext{3}{Institute for Advanced Study, Einstein Drive, Princeton, NJ 08540, USA}
\altaffiltext{4}{Hubble fellow}



%% Abstract
\begin{abstract}
Starting point for abstract: my old poster abstract. [TO DO] We aim to recover the Milky Way's gravitational potential using action-based dynamical modeling (cf. Bovy \& Rix 2013, Binney \& McMillan 2011, Binney 2012). This technique works by modeling the observed positions and velocities of disk stars with an equilibrium, three-integral quasi-isothermal distribution function. In preparation for the application to stellar phase-space data from Gaia, we create and analyze a large suite of mock data sets and we develop qualitative "rules of thumb" for which characteristics and limitations of data, model and code affect constraints on the potential most. We investigate sample size and measurement errors of the data set, size and shape of the observed volume, numerical accuracy of the code and action calculation, and deviations of the data from the assumed family of axisymmetric model potentials and distribution functions. This will answer the question: What kind of data gives the best and most reliable constraints on the Galaxy's potential?
\end{abstract}

%% Keywords
\keywords{Galaxy: disk --- Galaxy: fundamental parameters --- Galaxy: kinematics and dynamics --- Galaxy: structure}

\section{Introduction}

[TO DO]

\paragraph{Collection of thoughts for the introduction}
\begin{itemize}
\item \textbf{Our modelling method in a nutshell:} We fit simultaneously a model for the Galaxy's gravitational potential and an orbit distribution function (df) to stellar phase-space data. To turn a star's position and velocity into a full orbit, we need the gravitational potential in which the star moves. We assume that we know a family of orbit distribution functions that are close enough to the real distribution of orbits. In this case the stellar orbits calculated within a proposed potential will only follow such a df, if this potential model is close enough to the true potential.
\\Or in other words: We need the potential to calculate orbits. At the same time, if we \textit{know} the true orbits, we can deduce the true potential from them. To find the true orbits, we make use of the predictive power of an orbit distribution function.

\item \textbf{Motivation to use this modelling technique in the Milky Way:} Bovy et al. 2012 .... [TO DO]

\item \textbf{Introducing orbits and actions:} There are different ways to describe stellar orbits. The most obvious is to give the stars position and velocity vector at each point in time, by evaluating the potential forces that act on the star in each time step. Most orbits in realistic galaxy potentials  are however not closed, so we would have to integrate the orbit forever. Another, much more convenient way to describe orbits, are so called integrals of motion. These integrals are functions of the star's time-dependent position and velocity, but are themselves constants in time, i.e. conserved quantities. The most obvious integral in static potentials is the energy of the orbit. Symmetries in potentials frequently allow more than one integral: In spherical potentials all three components of the angular momentum are conserved. In many axisymmetric potentials there is, in addition to the energy $E$ and vertical component of the angular momentum $L_z$, a third non-classical integral of motion $I_3$, which has however no easy physical meaning.  (Binney \& Tremaine, Galactic Dynamics)\\
Because any function of integrals is an integral of motion itself, it is possible to construct integrals that have both very convenient properties and intuitive physical meanings. One such a set are the so-called actions. In axisymmetric potentials they are frequently called the radial action $J_R$, the vertical action $J_z$ and the $\phi$-action, which is simply the vertical component of the angular momentum, $L_z$. The radial action and vertical action quantify the amount of oscillation in radial and vertical direction that the orbit exhibits.  Actions are constructed in such a way, that they are not only integrals, but also correspond to the momenta in a set of canonical coordinates. The canonical conjugate positions of the actions are the so-called angles, which have the convenient properties, that they increase strictly linearly in time while the star moves along the orbit. They are periodic in $2\pi$ and the frequencies by which they change are functions of the actions. In the action-angle coordinate system, the only thing we need to fully describe an orbit in an axisymmetric potential are therefore just three fixed numbers, the actions. 

\item \textbf{Using actions for distribution functions:} Actions are therefore the natural coordinates of orbits and each point in action space corresponds to one specific orbit in a given potential. It is often used in dynamical modelling, e.g. in the Schwarzschild superposition method (source???), to reconstruct a galaxy by superimposing different orbits and populating them with stars. In this way these kind of methods construct orbit distribution functions for galaxies, which are at the same time distribution functions in action space. Because angles increase linearly in time, when a star moves along its orbit, stars are uniformly distributed in angle space. Therefore a orbit distribution function in terms of actions and a uniform distribution of stars in angle-space can be directly mapped to a distribution of stars in canonical configuration phase-space, measurable stellar positions and velocities. While a stellar distribution in configuration space is six-dimensional, the distribution in action-angle space is effectively three-dimensional, because of the uniformity in angles. (Rewrite, too verbose...)

\item \textbf{Why should we care about actions in realistic galaxies?} In reality galaxies have rarely perfectly static and axisymmetric potentials, which drastically reduces the number of conserved quantites along orbits. In static non-axisymmetric  potentials there can still be two integrals of motion, angular momentum however is no longer conserved. The Milky Way's disk might have an overall axisymmetric appearance, but is perturbed by spiral arms. The strongest deviation from axisymmetry in the Galaxy is the bar, which also causes the Galactic potential to vary slowly in time. The stirrs up the stars of the disk and the potential and causes radial migration of the orbits (Reference???), orbits change and with them the actions. One could wonder if, under such non-axisymmetric, non-static potential conditions, the assumption and treatment of globally conserved actions in the Milky Way is still a sensible approach. First of all, actions are the natural way to treat orbits and they can be locally defined, even if they might not be globally conserved. As long as we care about orbits, we should care about actions. An orbit carries information about the star's past, about where the star was born and which tidal processes might have carried it away from its inital orbit. Together with the chemistry of the stars, which determined by their place of birth, their current orbits are valuable diagnostics for the evolution and structure of the Milky Way. Secondly, gravitational processes do only in the most extreme cases completely change the actions. In a slowly changing potential, where orbits adapt adiabatically to those changes, actions are conserved (Binney \& Tremaine, Galactic Dynamics). And even during bar-induced radial migration at least the vertical actions are conserved and will continue to carry some amount of information about the stars' inital orbit distribution.\\

[TO DO] (Maybe cite Potzen 2015, who showed that analysing aspherical systems in spherical actions can still be a powerful tool, when used with care...)

\item \textbf{Why should we care about an axisymmetric "best fit" model for the Milky Way disk?} [TO DO]

\item \textbf{Previous results with this modelling technique:} Bovy \& Rix 2013 ... [TO DO]

\item \textbf{Motivating this method characterization in anticipation of GAIA:} [TO DO]
\end{itemize}

\section{Method}

\subsection{Actions}

[TO DO]


\subsection{Distribution function}

[TO DO]

\subsection{Potential models}

[TO DO] Mention different ways to calculate actions in different potentials.

\subsection{Mock Data}

[TO DO]

\paragraph{Collection of possible tests and plots}

\begin{itemize}
\item *Diagram 1*: schematic flow chart of how to sample mock data (could be helpful for people, who want to sample mock data in action space and didn't know how to start, like me)
\item *Plot 2:* 2 triangle plots with (jr, lz, jz) on the axes to show the distribution of stars in action space within mock data sets - for a large sphere and a small sphere. (I thought it was very instructive to see how the spatial selection function shapes the distribution of actions, it also helped me understand which orbits have which actions.)
\item *Plot 3:* distribution of mock data set in real space: z vs. R. and vz vs. R, maybe for a hot and cold population? (maybe a bit boring? Would be however illustrative, that the mock data sampled from the qdf is indeed similar to something we could observe. Also: could make a 4 sigma contour in the vz vs. R plot, to show, that the choice of integration limits is important but 4 sigma should be sufficient.)
\end{itemize}

\subsection{Measurement Errors}

[TO DO]

\subsection{Analysis}

[TO DO] Don't forget: How to choose the fitting ranges.

\section{Results}

\subsection{Verification of the Method}

\paragraph{Collection of possible tests and plots}

\begin{itemize}
\item *Plot 1:* two panels: 
\begin{itemize}
\item a) convergence of the normalisation vs. ngl\_vel (GL order of integrating the qdf over the velocities to get the density), 
\item b) convergence of the normalisation vs. n\_dens (number of grid points in each (R,z) at which the density is explicitely calculated, before interpolating and integrating over the volume to get the normalisation). \\ 
 This might not be a very exciting plot, but when we later show plots, that demonstrate e.g. how robust the method is against incompleteness, people might think, that in this case the normalization is not so important and time could be saved in calculating it. We know, that it is important to get the normalisation right. Plus, it proves, that possible biases when using the St\"ackel approximation are not due to a wrong normalisation.
 \end{itemize}
\item *Test 1:* Isochrone potential, 2 different b, 2 different populations, 5 different SF (isoSph test suite) \\
*Plot 2:* scatter plot (offset / stddev) vs. (stddev / true value [\%]) for b and one qdf parameter --> and panel with normal distribution. This plot could show 3 things:
\begin{itemize}
\item Central limit theorem is satisified --> method works.
\item Bigger volumes give better constraints.
\item hot populations seem to give tighter constraints on the potential.
\end{itemize}
\item *Plot 3:* Would be cool to have a plot, that shows that for the St\"ackel potential we don't get biases, but that there are some for the analytic Miyamoto-Nagai + power-law halo \& interpolated MW potential and therefore this bias is probably due to incorrect action calculation.
\item *Plot 4:* stddev ~ 1/sqrt(N)
\end{itemize}


\subsection{Do shape and position of the observation volume matter?}

\paragraph{Collection of possible tests and plots}

 *Test 1:* Compare results of wedges of same volume, but different positions and orientations. 
 \begin{itemize}
    \item I guess, the ones that demonstrate, that phi-coverage is much less important than R and z coverage, is boring, right? And I already have a plot in 3.1 that shows, that larger volumes are better. 
    \item This test suite was made with the MW-like potential and there seem to be biases, that are different for different volumes. If we say, okay, we have to deal with whatever biases we get, I could still include those volumes with good R AND z coverage, because for them the biases seem to be smaller.
    \item I might add a few more volumes, e.g. one with large vertical coverage at different positions
    \item Do we explicitely want to test, if it matters, if the radial coverage is larger or smaller the disk scale length, and the vertical coverage is larger or smaller than the disk scale height?\\
*Plot 1:* 
    a) cross section of volumes in R and z
    b) offset / stddev vs. stddev / true value [\%], that demonstrates, that it doesn't matter much for the potential recovery, if we have more radial or vertical coverage, and the position within the galaxy. 
     \end{itemize}
     
\subsection{What if our assumptions on the (in-)completeness of the data set are incorrect?}

\paragraph{Collection of possible tests and plots}

\begin{itemize}
\item  *Test 1:* isochrone potential, b=0.9 kpc, two populations, completeness$(d) = 1 - \epsilon \cdot d/Rmax$, where Rmax is radius of spherical selection function. Marginalize over vT in analysis. \\
*Plot 1*: Violin plot: x-axis - $\epsilon$. y-axis: b-parameter and one of the qdf parameters.
\item  *Test 2:* isochrone potential, two populations, incompleteness function that depends only on z. \\
*Plot 2*: violin plot
\end{itemize}

\subsection{What if our assumed distribution function differs from the star's DF?}

\paragraph{Collection of possible tests and plots}

\begin{itemize}
\item *Test 1:* mix hot and cold populations, 5 free qdf parameters in analysis!, use code that estimates the best velocity integration ranges. h\_sigma\_r \& h\_sigma\_z are the same for both populations, sigma\_r and sigma\_z have the same ratio, but are 50\% different for the two populations. h\_R is also 50\% different. Vary the fraction of pollution. Idea behind this: What if the stellar distribution has a different shape, e.g. added "wings", or had a different tracer density decrease with R. Would be however great, if we could show how the mixture of qdf's quanlitatively changes the shape of the df. Any ideas? \\
*Plot 1:* Violin plot: x-axis - fraction of pollution. y-axis: b-parameter and one or two qdf parameters.
\item *Test 2:* same as Test 1, but this time vary the degree of difference and make it 50\% pollution. Idea behind this: What happens, if we have errors in the abundances and mix different MAPs? For this it would be could to compare how much the qdf parameters of neighbouring MAPs differ and how big the difference between MAPs can be, such that it still can reproduce the potential. \\
*Plot 2:* Violin plot: x-axis - difference in qdf parameters. y-axis: b-parameter and one or two qdf parameters.
\end{itemize}

\subsection{What if our assumed potential model differs from the real potential?}

\paragraph{Collection of possible tests and plots}

*Test 1:* Try to recover a Miyamoto-Nagai disk + power-law halo potential by fitting a 2-component St\"ackel potential. \\
*Plot 1:* 
\begin{itemize}
   \item (R,z)-plane: color coding: difference between true potential's F\_R and best fit potential F\_R
    \item (R,z)-plane: color coding: difference between true potential's F\_z and best fit potential F\_z \\
    Any idea how to account for the error bars on the best fit potential?
\end{itemize}

\subsection{Effect of measurement errors on recovery of potential?}

\paragraph{Collection of possible tests and plots}

\begin{itemize}
\item *Plot 1:* The plot I had on the poster, which shows the number of MC samples needed for given maximum error. However, we still haven't tested, if this plot depends on: 
    * hotness of stars
    * number of stars
\item *Plot 2:* Some plot that shows, that our approximation of ignoring distance errors works. Any ideas?
\item *Test 1:* One selection function, one population, vary the size of the proper motion error (don't forget to adapt the number of MC samples needed) \\
*Plot 3:* (width of pdf) vs. (maximum velocity error / temperature parameter)
\end{itemize}



\section{Conclusion}

[TO DO]

\section{Questions that haven't been covered so far:}

\begin{itemize}
\item What limits the overall code speed?
\item What happens, when the errors are not uniform?
\item What if errors in distance matter for selection?
\item Deviations from axisymmetry: Take numerical simulations.
\end{itemize}

%===============================================


\begin{figure}
%\plottwo{~/BovyCode/analyzeFlexible/plots/isoSphFlex/isoSphFlex_short_cold_2kpc_1d_DF:5_POT:2_triangle_MCMC_bw.eps}{~/BovyCode/analyzeFlexible/plots/isoSphFlex/isoSphFlex_short_cold_2kpc_1d_DF:5_POT:2_triangle_MCMC_color.eps}
\plotone{~/BovyCode/analyzeFlexible/plots/isoSphFlex/isoSphFlex_short_cold_2kpc_1d_DF:5_POT:2_triangle_MCMC_bw.eps}
\caption{This figure demonstrates the shape of the likelihood in eq. (???) in the parameter space $\{p_\Phi,\ln(p_{DF})\}$. The mock data set analysed here has 20,000 stars and was created in a isochrone potential with $p_\Phi = \{v_{circ},b \}=\{230 \text{ km/s },0.9\text{ kpc } \}$, observed within a spherical volume around the sun of radius $r = 2 \text{ kpc }$, and represents a rather hot stellar population with DF parameters $p_{DF} = \{ h_R, \sigma_R, \sigma_z,h_{\sigma_R},h_{\sigma_z}\} =\{2 \text{ kpc }, 55 \text{ km/s }, 66 \text{ km/s }, 8 \text{ kpc }, 7 \text{ kpc }\} $.  The true parameters are marked by dotted lines. The dark, medium and bright gray contours in the 2D distributions represent 1, 2 and 3 sigma confidence regions, respectively, and show weak or moderate covariances. The likelihood here was sampled using MCMC (with flat priors in $p_\Phi$ and  $\ln(p_{DF})$ to turn the likelihood into a full posterior distribution function). Because only 10,000 MCMC samples were used to create the histograms shown, the 2D distribution has noisy contours. The dashed lines in the 1D distributions are Gaussian fits to the histogram of MCMC samples. This demonstrates very well that for such a large number of stars, the likelihood approaches the shape of a multi-variate Gaussian, as expected from the central limit theorem.}
\end{figure}


%===============================================

\begin{thebibliography}{}
\bibitem[Bovy \& Rix(2013]{bov13} Bovy, J., \& Rix, H.-W., 2003, \apj, ???, ???
\end{thebibliography}

\end{document}
