\subsection{Dealing with Measurement Errors and their Effect on the Parameter Recovery} \label{sec:results_errors}

\paragraph{Convergence of the error integral.} In \S \ref{sec:likelihood} we introduced how we convolve the model probability with the measurement errors. In the absence of distance errors the accuracy of the parameter recovery is limited by an insufficient MC sampling of the convolution integral in Equation (\ref{eq:errorconv}). Test \ref{test:isoSphFlexErrConv_MC_vs_error} in Table \ref{tbl:tests} and Figure \ref{fig:isoSphFlexErrConv_MC_vs_error} investigate how many MC samples are needed, given the size of the velocity error, for the integral to be accurate within certain limits:
\\For each $\delta \mu \in [2,3,4,5] \text{mas yr}^{-1}$ we set up four mock data sets and evaluated the likelihood for different $N_\text{error}$. We used $N_\text{conv} :=$ 800 and 1200 MC samples to calculate the numerically converged likelihood for proper motion errors $\delta \mu \leq 3 \text{mas yr}^{-1}$ and $\delta \mu > 3 \text{mas yr}^{-1}$, respectively (see left panels in Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE}). We determined the mean bias 
\begin{equation*}
\text{BIAS}(N_\text{error},\delta \mu) \equiv \frac{1}{4} \sum_{j=1}^4 \left[ \langle p_i \rangle (N_\text{error},\delta \mu)\right]_j - \left[ \langle p_i \rangle (N_\text{conv},\delta \mu)\right]_j,
\end{equation*}
where $\left[ \langle p_i \rangle (N_\text{error},\delta \mu)\right]_j$ is the best estimate for the $i$-th model parameter $p_i \in \pmodel$ from the analysis of the $j$-th mock data realisation with $\delta \mu$ using $N_\text{error}$ MC samples. From this we then generated the curves $N_{\text{error},i} (\delta v_\text{max},\text{BIAS})$ in Figure \ref{fig:isoSphFlexErrConv_MC_vs_error} by linear interplolation, that show how many MC samples are needed for parameter $p_i$ given a velocity error and a systematic bias in units of the standard error (SE) of the estimate. The proper motion error $\delta \mu$ translates to a velocity error according to 
\begin{equation}
\delta v_\text{max} [\text{km s}^{-1}] \equiv 4.74047 \cdot r_\text{max}[\text{kpc}] \cdot \delta \mu [\text{mas yr}^{-1}], \label{eq:vmax}
\end{equation}
where $r_\text{max}$ is the maximum distance of stars. We find in Figure \ref{fig:isoSphFlexErrConv_MC_vs_error} the relation
\begin{equation*}
N_{\text{error},i} (\delta v_\text{max},\text{BIAS}) \propto \left( \delta v_\text{max} \right)^2.
\end{equation*}
Figure \ref{fig:isoSphFlexErrConv_MC_vs_error} also demonstrates that different model parameters do not have the same sensitivity to the numerical inaccuracies introduced by insufficient sampling. [TO DO: we haven't tested yet, if this plot depends on hotness of population and / or number of stars. But if it takes forever to actually do the calculations, I guess, we just leave it like this.]

\paragraph{Testing the error convolved likelihood approximation.} In absence of distance (modulus) errors our approximation for the likelihood, which is the model probability convolved with the measurement errors in Equation (\ref{eq:errorconv}), is equal to the true likelihood. In case there \emph{are} distance modulus errors, this likelihood links the range of possible velocities (specified by the measurement errors in line-of-sight velocity, proper motion and distance modulus) to a fixed but slightly wrong position, as we ignore the distance error in the position. As the link between position and velocity provides the information about the potential, this will lead to systematic biases in the parameter recovery the larger the distance error becomes. In Test \ref{test:isoSphFlexErrConv_bias_vs_SE} in Table \ref{tbl:tests} and Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE} we investigate the capabilities of Equation (\ref{eq:errorconv}) with and without distance modulus errors.
\\The left column of panels in Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE} shows how well the approximation works in the absence of distance errors. There seemed to be no biases in the parameter recovery, independent of the size of the proper motion error. (We note that there could be a tiny bias $\ll 1$ SE in the $\ln(\sigma_{z,0} / 200\text{ km s}^{-1})$ qDF parameter, most likely due to insufficient numerical accuarcy, but all the other model parameters, also those not shown in the figure, are very well behaved.) Overall the standard errors on the recovered parameters are quite small (a few percent at most for 10,000 stars), which demonstrates that, if we perfectly knew the measurement errors, we still could get very precise constraints on the potential. The constraints also get tighter the smaller the proper motion error becomes. We found that for $\delta \mu = 1 \text{ mas yr}^{-1}$ the precision of the recovered parameters reduce by $\sim$ half compared to $\delta \mu = 5 \text{ mas yr}^{-1}$.
\\The right column of panels in Figure \ref{fig:isoSphFlexErrConv_bias_vs_SE} demonstrates the failure of our adopted likelihood approximation in the case of large distance modulus errors. The larger the $\delta(m-M)$, the wronger the recovered parameters become: The systematic biases can get many SEs large. We find however that in case of $\delta(m-M) \leq 0.2 \text{ mag}$ (if also $\delta \mu \leq 2 \text{ mas yr}^{-1}$ and a maximum distance of $r_\text{max} = 3 \text{ kpc}$, see Test \ref{test:isoSphFlexErrConv_bias_vs_SE} in Table \ref{tbl:tests}) the parameters can still be recovered within 2 SEs. For most model parameters (except $\ln(\sigma_{z,0} / 200\text{ km s}^{-1})$, as shown in the figure, and $\ln(h_R/ 8\text{ kpc})$) even $\delta(m-M) \leq 0.3 \text{ mag}$ still gives biases smaller than 2 SEs. This corresponds to a relative distance error of $\sim10\%$. This encourages us that for smaller distance modulus errors we really could use our likelihood approximation in Equation (\ref{eq:errorconv}), which is computationally cheaper than a proper treatment, also on real data sets.



\paragraph{Underestimation of the proper motion error.} We found that in case we perfectly knew the measurement errors (and the distance error is negligible), the convolution of the model probability with the measurement errors gives precise and accurate constraints on the model parameters - even if the error itself is quite large. Now we investigate what would happen if the quoted measurement errors, e.g. the proper motion errors, were actually smaller than the true errors. Figure \ref{fig:isoSphFlexErrSyst} shows the case for two different stellar populations and an error underestimation of 10\% and 50\%. 
\\Overall the parameter recovery gets worse the larger the proper motion error and the stronger the underestimation. The relation between the bias due to error misjudgment and the size of the proper motion error seems to be linear.
\\For the recovery of the isochrone potential scale length $b$ the hotness of the population does not matter (see lower left panel in Figure \ref{fig:isoSphFlexErrSyst}). The circular velocity $v_\text{circ}(R_\odot)$ is, as always, better measured by cooler than by hotter populations (see upper left panel in Figure \ref{fig:isoSphFlexErrSyst}). 
\\We find that the recovery of the qDF parameters on the other hand is more strongly affected by the misjudgment of the velocity error for \emph{cooler} stellar popluations. The measured velocity dispersion is the convolution of the intrinsic dispersion with the measurement errors. If the proper motion error is underestimated, the deconvolved velocity dispersion is larger than the intrinsic velocity dispersion and the relative difference is bigger for a cooler population (see upper right panel for $\sigma_{z,0}$ in Figure \ref{fig:isoSphFlexErrSyst}). The intrinsic velocity dispersion is also cooler at larger radii than at smaller radii, therefore the deconvolved dispersion is overestimated more strongly at large $R$ and the velocity dispersion scale length will be overestimated as well (see lower left panel for $h_{\sigma,z}$ in Figure \ref{fig:isoSphFlexErrSyst}). We get analogous results for the qDF parameters $\sigma_{R,0}$ and $h_{\sigma,R}$. The recovery of the tracer density scale length $h_R$ is not affected by the misjudgment of velocity errors. 
\\The most important and encouraging result from Figure \ref{fig:isoSphFlexErrSyst} is, that for an underestimation of $10\%$ the bias is still $\lesssim 2$ sigma [TO DO: can I say sigma???] - even for proper motion errors of almost $3$ mas/yr.

%=============================================================

\begin{figure}
\plotone{figs/isoSphFlexErrConv_MC_vs_error.eps}
\caption{Number of Monte Carlo (MC) samples $N_\text{error}$ needed for the numerical error convolution in Equation (\ref{eq:errorconv}), given the maximum velocity error $\delta v_\text{max}$ in the sample to reach a given accuracy.  An insufficient sampling of the convolution integral leads to systematic biases in the reconstruction of the true model parameters. The size of the bias is color coded as indicated in the legend and is given in units of the standard error (SE).  The model parameters, marked by different symbols, have different sensitivities to the numerical inaccuracy of the error convolution, therefore the range in $N_\text{error}$ for the same given bias. Here we assume that the distance error is zero and the proper motion error $\delta \mu$ translates to a velocity error according to Equation (\ref{eq:vmax}) and $\delta v_\text{los} \ll \delta v_\text{max}$. All model parameters are listed in Table \ref{tbl:tests} as Test \ref{test:isoSphFlexErrConv_MC_vs_error}. The number of MC samples needed increases with the velocity error as $N_\text{error} \propto \left( \delta v_\text{max} \right)^2$, as can be seen especially well in the inset figure for the potential parameter $v_\text{circ}(R_\odot)$. All lines are fits of this functional form to each four points derived for a given model parameter (symbol) and bias (color). The large scatter in the points comes from low number statistics and errors introduced by linear interpolation of the bias vs. $N_\text{error}$ relation found from the analyses. [TO DO: rename $h_{\sigma R}$ to $h_{\sigma,R}$, $\sigma_R$ to $\sigma_{R,0}$ and analogous for $z$] [TO DO: some of the 25 MC sample analyses have to be re-done. (Currently running on cluster.)]}
\label{fig:isoSphFlexErrConv_MC_vs_error}
\end{figure}


%=============================================================

\begin{figure}
\plotone{figs/isoSphFlexErrConv_bias_vs_SE.eps}
\caption{(Caption on next page.)}
\end{figure}

\addtocounter{figure}{-1}
\begin{figure} [t!]
\caption{Parameter recovery using the approximation for the measurement error convolved likelihood in Equation (\ref{eq:errorconv}). All model parameters used to create the mock data sets analyzed for this figure are given as Test \ref{test:isoSphFlexErrConv_bias_vs_SE} in Table \ref{tbl:tests}. The mock data sets in the left panels have only errors in line-of-sight velocity and proper motions, while the data sets in the right panels also have distance modulus errors, as indicated in the legends in the first row. The size of the error is color coded. The other panels plot the offset of the recovered model parameter to the true parameter vs. the relative standard error for two of the seven model parameters, the potential parameter $v_\text{circ}(R_\odot)$ and qDF parameter $\sigma_{z,0}$. For data sets with proper motion error errors $\delta(m-M) \leq 3 \text{mas yr}^{-1}$ Equation (\ref{eq:errorconv}) was evaluated with $N_\text{error}=800$, for $\delta(m-M) > 3 \text{mas yr}^{-1}$ we used $N_\text{error}=1200$. In the absence of distance errors Equation (\ref{eq:errorconv}) gives unbiased results, for $\delta(m-M) \geq 3 \text{mas yr}^{-1}$ (which corresponds in this test to $\delta v_\text{max} \lesssim 43$, see Equation (\ref{eq:vmax})) however biases of several sigma [TO DO: can I say sigma???] are introduced as Equation (\ref{eq:errorconv}) in only an approximation for the true likelihood in this case. [TO DO: rename  $\sigma_z$ to $\sigma_{z,0}$]}
\label{fig:isoSphFlexErrConv_bias_vs_SE}
\end{figure}




%=============================================================

\begin{figure}
\plotone{figs/isoSphFlexErrSyst_offset_vs_error.eps}
\caption{Effect of an systematic underestimation of proper motion errors in the recovery of the model parameters. The true model parameters used to create the mock data are summarized as Test \ref{test:isoSphFlexErrSyst} in Table \ref{tbl:tests}, four of them are given on the $y$-axes and the true values are indicated as black dashed lines. The velocities of the mock data were perturbed according to Gaussian errors in the $\alpha$ and $\delta$ proper motions as indicated on the $x$-axis.   The circles and triangles are the best fit parameters of several mock data set assuming the proper motion error, with which the model probability was convolved, was underestimated in the analysis by 10\% or 50\%, respectively. The error bars correspond to 1 sigma [TO DO: Can I say sigma????] confidence. The lines connect the mean of each two data realisations and are just guides to the eyes. [TO DO: rename $h_{\sigma z}$ to $h_{\sigma,z}$, $\sigma_z$ to $\sigma_{z,0}$]}
\label{fig:isoSphFlexErrSyst}
\end{figure}

%=============================================================