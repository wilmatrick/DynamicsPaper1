\section{Dynamical Modelling}


%=============================================

\begin{deluxetable*}{lllrl}
\tabletypesize{\scriptsize}
\tablecaption{Gravitational potentials of the reference galaxies used troughout this work and the respective ways to calculate actions in these potentials. All four potentials are axisymmetric. The potential parameters are fixed for the mock data creation at the values given in this table. In the subsequent analyses we aim to recover these potential parameters again. The parameters of \texttt{MW13-Pot} and \texttt{KKS-Pot} were chosen to resemble the \texttt{MW14-Pot} (see Figure \ref{fig:ref_pots}). We use $v_\text{circ}(R_\odot)$ = $230$ km s$^{-1}$ for all potentials in this work. \label{tbl:referencepotentials}}
\tablewidth{0pt}
\tablehead{
\colhead{name} & \colhead{potential type} & \multicolumn{2}{c}{potential parameters $p_\Phi$} & \colhead{action calculation}}
\startdata
\texttt{Iso-Pot}      & isochrone potential\tablenotemark{(a)} & $b$& $0.9~\text{kpc}$ & \textbf{\emph{analytical and exact}} \\
                               & \citep{1959AnAp...22..126H} &                                            &                               & (\citealt{2008gady.book.....B}, \S 3.5.2) \\
\tableline
\texttt{KKS-Pot}    & 2-component                            & $\Delta$                                              & $0.3$   & \textbf{\emph{exact}} \\
                               & Kuzmin-Kutuzov-                      & $\left(\frac{a}{c}\right)_\text{Disk}$ & $20$    & using \emph{St\"{a}ckel Fudge} \\ 
                               & St\"{a}ckel potential\tablenotemark{(b)} & $\left(\frac{a}{c}\right)_\text{Halo}$ & $1.07$ & \citep{2012MNRAS.426.1324B} \\
                               & \hspace{0.3cm} (disk + halo) & $k$                                                       & $0.28$ & and interpolation \\
                               & \citep{1994AA...287...43B}                               &                                                              &               & on action grid\tablenotemark{(e)} \\
                               &                                                       &                                                              &                & \citep{2015ApJS..216...29B} \\
\tableline
\texttt{MW13-Pot} & MW-like potential\tablenotemark{(c)} with & $R_d$ & $3~\text{kpc}$ & \textbf{\emph{approximate}} \\ 
                               & Hernquist bulge,                         & $z_h$ & $0.4~\text{kpc}$  & (same as \texttt{KKS-Pot}) \\
                               & spherical power-law halo,        & $f_h$ & $0.5$ & \\
                               & 2 exponential disks                    & $\frac{\diff \ln(v_\text{circ}(R_\odot))}{ \diff \ln(R)}$ & $0$  & \\
                               & \hspace{0.3cm} (stars + gas)  &  & & \\
                               & \citep{2013ApJ...779..115B} & & &\\
\tableline
\texttt{MW14-Pot} & MW-like potential\tablenotemark{(d)} with &  & & \textbf{\emph{approximate}} \\
                               & cut-off power-law bulge, & & & (same as \texttt{KKS-Pot}) \\
                               & Miyamoto-Nagai stellar disk, & & & \\
                               & NFW halo & & & \\
                               & \citep{2015ApJS..216...29B} & & & \\
\enddata
\tablenotetext{(a)}{The isochrone potential \texttt{Iso-Pot} has one free parameter, the scale length $b$.} 
\tablenotetext{(b)}{The coordinate system of each of the two St\"{a}ckel-potential components of the \texttt{KKS-Pot} is $\frac{R^2}{\tau_{i,p}+\alpha_p} + \frac{z^2}{\tau_{i,p}+\gamma_p}=1$ with $p \in \{\text{Disk},\text{/Halo}\}$ and $\tau_{i,p} \in \{\lambda_p,\nu_p\}$. Both components have the same focal distance $\Delta \equiv \sqrt{\gamma_p-\alpha_p}$, to make sure that the superposition of the two components itself is still a St\"{a}ckel potential. The axis ratio of the coordinate surfaces $\left(\frac{a}{c}\right)_p := \sqrt{\frac{\alpha_p}{\gamma_p}}$ describes the flatness of the corresponding St\"{a}ckel component. The parameter $k$ describes the relative contribution of the disk mass to the total mass.} 
\tablenotetext{(c)}{The free parameters of the \texttt{MW13-Pot} are stellar disk scale length $R_d$ and height $z_d$, as well as the relative halo contribution to $v_\text{circ}^2(R_\odot)$, $f_h$, and the slope of the rotation curve, $\frac{\diff \ln(v_\text{circ}(R_\odot))}{ \diff \ln(R)}$.} 
\tablenotetext{(d)}{The \texttt{MWPotential2014} by \citet{2015ApJS..216...29B} (see their Table 1) has a circular velocity at the Sun of $v_\text{circ}(R_\odot)$ = $220$ km s$^{-1}$. In this work we use however $v_\text{circ}(R_\odot)$ = $230$ km s$^{-1}$ for all potentials.} 
\tablenotetext{(e)}{We use a finely spaced action interpolation grid with $R_\text{max}=10$ \Jo{[TO DO: What's that??? units???]} and 50 grid points in $E$ and $\psi$ \Jo{[TO DO: Find out what's that???]}, and 60 grid points in $L_z$.}
\end{deluxetable*}


%=============================================

\begin{deluxetable*}{lccccc}
\tabletypesize{\scriptsize}
\tablecaption{Reference distribution-function parameters for the qDF in Equations (\ref{eq:df_general})-(\ref{eq:sigmazRg}). These qDFs describe the phase-space distribution of stellar \MAPs{} for which mock data is created and analysed throughout this work for testing purposes. The parameters of the \texttt{cooler} \& \texttt{colder}  (\texttt{hotter} \& \texttt{warmer}) \MAPs{} were chosen to have the same $\sigma_{R,0}/\sigma_{z,0}$ ratio as the \texttt{hot} (\texttt{cool}) \MAP{}. The \texttt{colder} and \texttt{warmer} \MAPs{} have a free parameter $X$ that governs how much colder/warmer they are then the reference \texttt{hot} and \texttt{cool} qDFs. Hotter populations have shorter tracer scale lengths \citep{2012ApJ...753..148B} and the velocity dispersion scale lengths were fixed according to \citet{bov12c}. \label{tbl:referenceMAPs}}
\tablewidth{0pt}
\tablehead{
\colhead{name} & \multicolumn{5}{c}{qDF parameters $p_\text{DF}$}\\
                       & \colhead{$h_R$ [kpc]} & \colhead{$\sigma_{R,0}$ [km s$^{-1}$]} & \colhead{$\sigma_{z,0}$ [km s$^{-1}$]} & \colhead{$h_{\sigma,R}$ [kpc]} & \colhead{$h_{\sigma,z}$ [kpc]}}
\startdata
\texttt{hot}    & 2   & 55 & 66 & 8 & 7\\
\texttt{cool}   & 3.5 & 42 & 32 & 8 & 7\\
\tableline
\texttt{cooler} & 2  +50\% & 55-50\% & 66-50\% & 8 & 7 \\
\texttt{hotter} & 3.5-50\% & 42+50\% & 32+50\% & 8 & 7\\
\tableline
\texttt{colder} & 2  +X\% & 55-X\% & 66-X\% & 8 & 7 \\
\texttt{warmer} & 3.5-X\% & 42+X\% & 32+X\% & 8 & 7\\
\enddata
\end{deluxetable*}

%=============================================

%============================================



\Wilma{[TO DO: HW: In this section you have to indicate somehow, where you recapitulate BR13 and what is added new. "as in BR13", "beyond BR13"]}
\Wilma{TO DO: Comment from Hans-Walter: Basics of the method (binney, BR13) can be dramatically shortened. No need to sing the praises of \\DF's and actions. }

In this section we summarize the basic elements of \RM{}, the dynamical modelling machinery presented in this work, which in many respects follows \citet{2013ApJ...779..115B}.

\subsection{Coordinate System} \label{sec:coordinates}

Our modelling takes place in the Galactocentric rest-frame with cylindrical coordinates $\vect{x} \equiv (R,\phi,z)$ and corresponding velocity components $\vect{v} \equiv (v_R,v_\phi,v_z)$. If the stellar phase-space data is given in observed heliocentric coordinates, position $\tilde{\vect{x}} \equiv(\text{RA},\text{DEC},m-M)$ in right ascension RA, declination DEC and distance modulus $(m-M)$ as proxy for the distance from the sun, and velocity $\tilde{\vect{v}} \equiv (\mu_\text{RA},\mu_\text{DEC},v_\text{los})$ as proper motions $\vect{\mu}=(\mu_\text{RA},\mu_\text{DEC})$ \Jo{[TO DO: cos somwhere???]} in both RA and DEC direction and line-of-sight velocity $v_\text{los}$, the data $(\tilde{\vect{x}},\tilde{\vect{v}})$ has to be converted first into the Galactocentric rest-frame coordinates $(\vect{x},\vect{v})$ using the sun's position and velocity. We assume for the sun
\begin{eqnarray*}
(R_\odot,\phi_\odot,z_\odot) &=&(8 \text{ kpc}, 0^\circ, 0 \text{ kpc})\\
(v_{R,\odot},v_{T,\odot},v_{z,\odot}) &=& (0,230,0) \text{ km s}^{-1}.
\end{eqnarray*}

\subsection{Actions and Potential Models}  \label{sec:potentials}


Orbits in axisymmetric potentials are best described and fully specified by the three actions $\vect{J} \equiv (J_R, J_z, J_\phi=L_z)$, defined as
\begin{equation}
J_i = \frac{1}{2\pi} \oint_\text{orbit} p_i \diff x_i, \label{eq:action_general}
\end{equation}
and which depend on the potential via the connection between position $x_i$ and momentum $p_i$ along the orbit. Actions have a clear physical meaning: They quantify the amount of oscillation in each coordinate direction of the full orbit \HW{[TO DO: REF: HW suggested \citet{2008gady.book.....B}, but I can't find a corresponding statement in the book]}. The position of a star along the orbit is denoted by a set of angles, which form together with the angles a set of canonical conjugate phase-space coordinates (\citealt{2008gady.book.....B}, \S 3.5.1). \\

Even though actions are excellent orbit labels and arguments for stellar distribution functions, their computation is typically very expensive and depends on the choice of potential in which the star moves. The spherical isochrone potential \citep{1959AnAp...22..126H} is the only \Jo{[TO DO: Jo suggested "most general Galactic" instead of "only", but the isochrone is actually not Galactic... Ask him.]} potential for which Equation \ref{eq:action_general} takes an analytic form (\citealt{2008gady.book.....B}, \S 3.5.2). For St\"{a}ckel potentials actions can be calculated exactly by the (numerical) evaluation of a single integral. In all other potentials numerically calculated actions will always be approximations, unless Equation \ref{eq:action_general} is integrated along the whole (often not periodic) orbit.  A computational fast way to get actions for arbitrary axisymmetric potentials is the \emph{St\"{a}ckel fudge} by \citet{2012MNRAS.426.1324B}, which locally approximates the potential by a St\"{a}ckel potential. To speed up the calculation even more, an interpolation grid for $J_R$ and $J_z$ in energy $E$, angular momentum $L_z$ and \Jo{[TO DO: what else???]} can be build out of these St\"{a}ckel fudge actions, as described in \citet{2015ApJS..216...29B}.\\

For the gravitational potential in our modelling we assume a family of parametrized potential models with a fixed number of free parameters. We use different kinds of potentials: The Milky Way like potential from \citet{2013ApJ...779..115B} (\texttt{MW13-Pot}) with bulge, disk and halo; the spherical isochrone potential (\texttt{Iso-Pot}) in our test suites to make use of the analytic (and therefore exact and fast) way  to calculate actions; and the 2-component Kuzmin-Kutuzov St\"{a}ckel potential (\citealt{1994AA...287...43B}; \texttt{KKS-Pot}), which displays a disk and halo structure and also provides exact actions. Table \ref{tbl:referencepotentials} summarizes all reference potentials together used in this work with their free parameters $p_\Phi$. The density distribution of these potentials is illustrated in Figure \ref{fig:ref_pots}.\\

%=============================================

%FIGURE: reference potentials

\begin{figure*}[t]
\includegraphics[width=\textwidth]{figs/reference_potentials.eps}
\caption{Density distribution of the four reference galaxy potentials in Table \ref{tbl:referencepotentials}, for illustration purposes. These potentials are used throughout this work for mock data creation and potential recovery. \Wilma{[TO DO: Potential and/or population names in typewriter]}}
\label{fig:ref_pots}
\end{figure*}




%======================================================================================




\subsection{Stellar Distribution Functions} \label{sec:qDF}

Throughout, we assume that the orbits of each \MAP{} can be described by a single qDF of the form given by \citet{2011MNRAS.413.1889B}. This is motivated by the findings of \citet{bov12b,bov12c,2012ApJ...753..148B} and \citet{2013MNRAS.434..652T} about the simple phase-space structure of \MAPs{}, and following \citet{2013ApJ...779..115B} and their successful application. This qDF has the form
\begin{eqnarray}
&&\text{qDF}(\vect{J} \mid p_\text{DF}) \nonumber\\
&&= f_{\sigma_R}\left(J_R,L_z \mid p_\text{DF}\right) \times f_{\sigma_z}\left(J_z,L_z \mid p_\text{DF}\right)\label{eq:df_general}\end{eqnarray}
with
\begin{eqnarray}
f_{\sigma_R}\left(J_R,L_z \mid p_\text{DF}\right) &=& n \times \frac{\Omega}{\pi\sigma_R^2(R_g) \kappa}\exp\left(-\frac{\kappa J_R}{\sigma_R^2(R_g)} \right) \nonumber\\
&& \times \left[1+\tanh\left(L_z/L_0\right) \right]\\
f_{\sigma_z}\left(J_z,L_z \mid p_\text{DF} \right) &=& \frac{\nu}{2 \pi \sigma_z^2(R_g)} \exp\left( -\frac{\nu J_z}{\sigma_z^2(R_g)} \right).
\end{eqnarray}
Here $R_g \equiv R_g(L_z)$ and $\Omega\equiv \Omega(L_z)$ are the (guiding-center) radius and the circular frequency of the circular orbit with angular momentum $L_z$ in a given potential. $\kappa\equiv \kappa(L_z)$ and $\nu\equiv \nu(L_z)$ are the radial/epicycle ($\kappa$) and vertical ($\nu$) frequencies with which the star would oscillate around the circular orbit in $R$- and $z$-direction when slightly perturbed (\citealt{2008gady.book.....B}, \S 3.2.3) \Jo{[TO DO: ask someone, if I'm messing up different definitions of $\kappa$]}. The term $\left[1+\tanh\left(L_z/L_0\right) \right]$ suppresses counter-rotation for orbits in the disk with $L \gg L_0$ which we set to a small value ($L_0 = 10 \times R_\odot/8 \times v_\text{circ}(R_\odot)/220$ \Jo{[TO DO: Jo said, galpy default is 10 km/s kpc. But I got the value actually from the code...]}).
\\To match the observed properties of \MAPs{} (see \citealt{bov12b,bov12c,2012ApJ...753..148B}), we chose the functional forms
\begin{eqnarray}
n(R_g \mid p_\text{DF}) &\propto& \exp\left(-\frac{R_g}{h_R} \right)\\
\sigma_R(R_g \mid p_\text{DF}) &=& \sigma_{R,0} \times \exp\left(- \frac{R_g-R_\odot}{h_{\sigma,R}} \right)\label{eq:sigmaRRg}\\
\sigma_z(R_g \mid p_\text{DF}) &=& \sigma_{z,0} \times \exp\left(- \frac{R_g-R_\odot}{h_{\sigma,z}} \right)\label{eq:sigmazRg},
\end{eqnarray}
which indirectly set the stellar number density and radial and vertical velocity dispersion profiles. The qDF for each \MAP{} has therefore a set of five free parameters $p_\text{DF}$: the density scale length of the tracers $h_R$, the radial and vertical velocity dispersion at the solar position $R_\odot$, $\sigma_{R,0}$ and $\sigma_{z,0}$, and the scale lengths $h_{\sigma,R}$ and $h_{\sigma,z}$, that describe the radial decrease of the velocity dispersion. Throughout this work we use for illustration purposes a few example stellar populations, each following a single qDF, whose parameters are given in in Table \ref{tbl:referenceMAPs}. Most tests use the \texttt{hot} and \texttt{cool} qDFs from Table \ref{tbl:referenceMAPs}, which correspond to kinematically hot and cool populations, respectively.\\

One crucial point in our dynamical modelling technique (\S\ref{sec:likelihood}), as well as in creating mock data (\S\ref{sec:mockdata}), is to calculate the (axisymmetric) spatial tracer density $\rho_\text{DF}(\vect{x} \mid p_{\Phi},p_\text{DF})$ for a given qDF and potential . We do this by integrating the qDF at a given $(R,z)$ over all three velocity components, using a $N_v$-th order Gauss-Legendre quadrature for each integral:
\begin{eqnarray}
&&\rho_\text{DF}(R,|z| \mid p_{\Phi},p_\text{DF}) \nonumber\\
&&= \int_{-\infty}^{\infty} \text{qDF}(\vect{J}[R,z,\vect{v} \mid p_{\Phi}] \mid p_\text{DF}) \Diff3\vect{v}  \\%\label{eq:tracerdensity_general}\\
&&\approx \int_{-n_\sigma \sigma_R(R \mid p_\text{DF})}^{n_\sigma \sigma_R(R \mid p_\text{DF})} \int_{-n_\sigma\sigma_z(R \mid p_\text{DF})}^{n_\sigma \sigma_z(R \mid p_\text{DF})} \int_{0}^{1.5 v_\text{circ}(R_\odot)}  \nonumber\\
& & \hspace{1cm} \text{qDF}(J[R,z,\vect{v} \mid p_{\Phi}] \mid p_\text{DF}) \diff v_T \diff v_z \diff v_R, \label{eq:tracerdensity}
\end{eqnarray}
where $\sigma_R(R \mid p_\text{DF})$ and $\sigma_z(R \mid p_\text{DF})$ are given by Equations \ref{eq:sigmaRRg} and \ref{eq:sigmazRg} and the integration ranges are motivated by Figure \ref{fig:kks2WedgeEx}. The integration range $[0,1.5 v_\text{circ}(R_\odot)]$ over $v_T$ is in general sufficient (only for observation volumes at smaller Galactocentric radii with larger velocities this upper limit needs to be increased). For a given $p_\Phi$ and $p_\text{DF}$ we explicitly calculate the density on $N_x \times N_x$ regular grid points in the $(R,z)$ plane; in between grid points the density is evaluated with a bivariate spline interpolation. The grid is chosen to cover the extent of the observations (for $|z|\leq0$, because the model is symmetric in $z$ by construction). The total number of actions that need to be calculated to set up the density interpolation grid is $N_x^2 \cdot N_v^3$. \S\ref{sec:likelihood} and Figure \ref{fig:norm_accuracy} show the importance of choosing $N_x$, $N_v$ and $n_\sigma$ sufficiently large in order to get the density with an acceptable numerical accuracy \Wilma{[TO DO: Jo thinks that this statement is difficult to understand here, because you have not yet talked about the normalization]}. 


\subsection{Selection Functions} \label{sec:selectionfunction}

Any survey's selection function can be understood as defining an effective sample subvolume in the space of observables: e.g. position on the plane of the sky (the survey area), distance from the sun (limited by the brightness of the stars and the sensitivity of the detector), colors and metallicity of the stars (limited by survey mode and targeting).
\\We simply use spatial selection functions, which describe the probability to observe a star at $\vect{x}$,
\begin{eqnarray*}
\text{sf}(\vect{x}) \equiv \begin{cases}
\text{completeness}(\vect{x}) &\text{if $\vect{x}$ within observed volume}\\
0 & \text{outside.}
\end{cases}
\end{eqnarray*}
For the observed volume we use simple geometrical shapes. Either a sphere of radius $r_\text{max}$ with the sun at its center, or an angular segment of an cylindrical annulus (\texttt{wedge}), i.e. the volume with $R \in [R_\text{min},R_\text{max}],\phi \in [\phi_\text{min},\phi_\text{max}],z \in [z_\text{min},z_\text{max}]$ within the model galaxy. The sharp outer cut of the survey volume could be understood as the detection limit in apparent brightness in the case, where all stars have the same luminosity. Here $0 \leq \text{completeness}(\vect{x}) \leq 1$ everywhere inside the observed volume, so it can be understood as a position-dependent detection probability. Unless explicitly stated otherwise, we simplify to $\text{completeness}(\vect{x}) = 1$.
