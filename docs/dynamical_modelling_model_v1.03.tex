\subsection{Actions and Potential Models}  \label{sec:potentials}

\paragraph{Actions.} Orbits in axisymmetric potentials are best described and fully specified by the three actions $J_R, J_z$ and $J_\phi=L_z$. They are integrals of motion and generally defined as
\begin{equation}
J_i = \frac{1}{2\pi} \int_\text{orbit} p_i(t) \diff x_i(t) \label{eq:action_general}
\end{equation}
and depend on the potential via the connection between position $x_i$ and momentum $p_i$ along the orbit. Actions have a clear physical meaning: They quantify the amount of oscillation in each coordinate direction of the full orbit [REF]. The position of a star along the orbit is denoted by a set of angles, which form together with the angles a set of canonical conjugate phase-space coordinates \citep{bin08}. Even though actions are the optimal choice as orbit labels and arguments for stellar distribution functions, their computation is very expensive.

\paragraph{Action calculation.} The action calculation depends on the choice of potential in which the star moves: The spherical isochrone \citep{bin08} is the only potential for which Eq. (\ref{eq:action_general}) takes an analytic form. For axisymmetric St\"{a}ckel potentials actions can be calculated exactly by the (numerical) evaluation of a single integral. In all other potentials numerically calculated actions will always be approximations, unless Eq. (\ref{eq:action_general}) is integrated up to infinity.  A computational fast way to get actions for arbitrary axisymmetric potentials is the "St\"{a}ckel fudge" by \citet{bin12}, which locally approximates the potential by a St\"{a}ckel potential. To speed up the calculation even more, an interpolation grid can be build out of these St\"{a}ckel fudge actions, as described in \citet{bov15}. 

\paragraph{Potential models.} In our modelling we assume a family of parametrized potentials with a fixed number of free parameters. We use different kinds of potentials: Besides the Milky Way like potential from \citet{bov13} ("MW13-Pot" ) with bulge, disk and halo, we also extensively use the spherical isochrone potential ("Iso-Pot") in our test suites to make use of the analytic (and therefore exact and fast) way  to calculate actions. In addition we use the 2-component Kuzmin-Kutuzov St\"{a}ckel potential by \citet{bat94} ("KKS-Pot"), which displays a disk and halo structure and also provides exact actions. Table \ref{tbl:referencepotentials} summarizes all reference potentials together used in this work with their free parameters $p_\Phi$. The density distribution of these potentials is illustrated in Fig. \ref{fig:ref_pots}.

%======================================================================================

\begin{deluxetable}{llllll}
\tabletypesize{\scriptsize}
\rotate
\tablecaption{Gravitational potentials of the reference galaxies used troughout this work and the respective ways to calculate actions in these potentials. All four potentials are axisymmetric. The potential parameters are fixed for the mock data creation. In the subsequent analyses we aim to recover these potential parameters again. The parameters of "MW13-Pot" and "KKS-Pot" were found as best fits to the "MW14-Pot". \label{tbl:referencepotentials}}
\tablewidth{0pt}
\tablehead{
\colhead{name} & \colhead{potential type} & \multicolumn{2}{c}{potential parameters $p_\Phi$} & \colhead{action calculation} & \colhead{reference for potential type}}
\startdata
"Iso-Pot" & isochrone potential   & circular velocity at the sun             & $v_\text{circ}$ = $230$ km s$^{-1}$           & \textbf{\emph{analytical and exact}} $J_r, J_\vartheta, L_z$;     & \citet{bin08} \\
          &					      & isochrone scale length                   & $b$ = $0.9$ kpc                               & use $J_r \rightarrow J_R, J_\vartheta \rightarrow J_z $  &               \\
          &                       &                                          &                                               & in eq. (???)                                             &               \\
\tableline
"KKS-Pot" & 2-component                  & circular velocity at the sun             & $v_\text{circ}$ = $230$ km s$^{-1}$           & \textbf{\emph{exact}} $J_R, J_z, L_z$       & \citet{bat94} \\
          & Kuzmin-Kutuzov-              & focal distance of coordinate system\tablenotemark{a}       & $\Delta = 0.3$              & using "St\"{a}ckel Fudge"                   &               \\                                                                
          & St\"{a}ckel potential        & axis ratio of the coordinate surfaces\tablenotemark{a} ... &                             & \citep{bin12}                               &               \\
          & \hspace{0.3cm} (disk + halo) & \hspace{0.3cm} ...of the disk component   & $\left(\frac{a}{c}\right)_\text{Disk}$ = 20  & and interpolation                           &               \\
          &                              & \hspace{0.3cm} ...of the halo component   & $\left(\frac{a}{c}\right)_\text{Halo}$ = 1.07& on action grid                              &               \\
          & (analytic potential)         & relative contribution of the disk mass    &                                              & \citep{bov15}                               &               \\
          &                              & \hspace{0.3cm} to the total mass          & $k = 0.28$                                   &                                             &               \\  
\tableline
"MW13-Pot" & MW-like potential with        & circular velocity at the sun             & $v_\text{circ}$ = $230$ km s$^{-1}$           & \textbf{\emph{approximate}} $J_R, J_z, L_z$ & \citet{bov13} \\          
           & Hernquist bulge,              & stellar disk scale length                & $R_d = 3$ kpc                                 & using "St\"{a}ckel Fudge"          &               \\
           & 2 exponential disks           & stellar disk scale height                & $z_h = 0.4$ kpc                               & \citep{bin12}                      &               \\
           & \hspace{0.3cm} (stars + gas), & relative halo contribution to $v_\text{circ}^2(R_\odot)$ & $f_h = 0.5$                   & and interpolation                  &               \\
           & spherical power-law halo      & "flatness" of rotation curve & $\frac{\diff \ln(v_\text{circ}(R_\odot))}{ \diff \ln(R)}$ = 0  & on action grid                &               \\
           & (interpolated potential)      &                                          &                                               & \citep{bov15}                      &               \\
\tableline
"MW14-Pot" & MW-like potential with        &  -                                       & -                                             & \textbf{\emph{approximate}} $J_R, J_z, L_z$ & \citet{bov15} \\
           & cutoff power-law bulge,       &                                          &                                               & (see "MW13-Pot")                   &               \\
           & Miyamoto-Nagai stellar disk,  &                                          &                                               &                                    &               \\
           & NFW halo                      &                                          &                                               &                                    &               \\
\enddata
\tablenotetext{a}{The coordinate system of each of the two St\"{a}ckel-potential components is $\frac{R^2}{\tau_{i,p}+\alpha_p} + \frac{z^2}{\tau_{i,p}+\gamma_p}=1$ with $p \in \{\text{Disk},\text{/Halo}\}$ and $\tau_{i,p} \in \{\lambda_p,\nu_p\}$. Both components have the same focal distance $\Delta = \sqrt{\gamma_p-\alpha_p}$, to make sure that the superposition of the two components itself is still a St\"{a}ckel potential. The axis ratio of the coordinate surfaces $\left(\frac{a}{c}\right)_p := \sqrt{\frac{\alpha_p}{\gamma_p}}$ describes the flattness of the corresponding St\"{a}ckel component.}
\end{deluxetable}

%=============================================

%FIGURE: reference potentials

\begin{figure}
\plotone{figs/reference_potentials.eps}
\caption{Density distribution of the four reference galaxy potentials in table \ref{tbl:referencepotentials}, for illustration purposes. These potentials are used throughout this work for mock data creation and potential recovery. [TO DO: Halo sichtbarer machen, evtl. mit isodensity contours]}
\label{fig:ref_pots}
\end{figure}

%=============================================

\subsection{Distribution Function} \label{sec:qDF}

\paragraph{Distribution Function.} Motivated by the findings of Bovy et al. 2012??? and \citet{tin13} about the simple phase-space structure of \MAPs, and following \citet{bov13} and their successful application, we also assume that each \MAP follows a single qDF of the form given by \citet{bin11}.  This qDF  is a function of the actions $\vect{J}=(J_R,J_z,L_z)$ and has the form
\begin{eqnarray}
\text{qDF}(\vect{J} \mid p_\text{DF}) &=& f_{\sigma_R}\left(J_R,L_z \mid p_\text{DF}\right) \times f_{\sigma_z}\left(J_z,L_z \mid p_\text{DF}\right)\label{eq:df_general}\\
\text{with } f_{\sigma_R}\left(J_R,L_z \mid p_\text{DF}\right) &=& n \times \frac{\Omega}{\pi\sigma_R^2(R_g) \kappa}\left[1+\tanh\left(L_z/L_0\right) \right]\exp\left(-\frac{\kappa J_R}{\sigma_R^2(R_g)} \right) \\
f_{\sigma_z}\left(J_z,L_z \mid p_\text{DF} \right) &=& \frac{\nu}{2 \pi \sigma_z^2(R_g)} \exp\left( -\frac{\nu J_z}{\sigma_z^2(R_g)} \right) \\
\end{eqnarray}
Here $R_g \equiv R_g(L_z)$ and $\Omega\equiv \Omega(L_z)$ are the (guidig-center) radius and the circular frequency of the circular orbit with angular momentum $L_z$ in a given potential. $\kappa\equiv \kappa(L_z)$ and $\nu\equiv \nu(L_z)$ are the radial/epicycle ($\kappa$) and vertical ($\nu$) frequencies with which the star would oscillate around the circular orbit in $R$- and $z$-direction when slightly perturbed \citep{bin08}. The term $\left[1+\tanh\left(L_z/L_0\right) \right]$ suppresses counter-rotation for orbits in the disk with $L \gg L_0$ which we set to a random small value ($L_0 = 10 \times R_\odot/8 \times v_\text{circ}(R_\odot)/220$).
\\For this qDF to be able to incorporate the findings by Bovy et al. 2012??? about the phase-space structure of \MAPs summarized in \S\ref{sec:intro}, we set the functions $n$,  $\sigma_R$ and $\sigma_z$, which indirectly set the stellar number density and radial and vertical velocity dispersion profiles,
\begin{eqnarray}
n(R_g \mid p_\text{DF}) &\propto& \exp\left(-\frac{R_g}{h_R} \right)\\
\sigma_R(R_g \mid p_\text{DF}) &=& \sigma_{R,0} \times \exp\left(- \frac{R_g-R_\odot}{h_{\sigma_R}} \right)\label{eq:sigmaRRg}\\
\sigma_z(R_g \mid p_\text{DF}) &=& \sigma_{z,0} \times \exp\left(- \frac{R_g-R_\odot}{h_{\sigma_z}} \right)\label{eq:sigmazRg}.
\end{eqnarray}
The qDF for each \MAP has therefore a set of five free parameters $p_\text{DF}$: the density scale length of the tracers $h_R$, the radial and vertical velocity dispersion at the solar position $R_\odot$, $\sigma_R,0$ and $\sigma_z,0$, and the scale lengths $h_{\sigma_R}$ and $h_{\sigma_z}$, that describe the radial decrease of the velocity dispersion. The \MAPs we use for illustration through out this work are summarized in Table \ref{tbl:referenceMAPs}.

\paragraph{Tracer Density.} One crucial point in our dynamical modelling technique (\S ???), as well as in creating mock data (\S\ref{sec:mockdata}), is to calculate the (axisymmetric) spatial tracer density $\rho_\text{DF}(\vect{x} \mid p_{\Phi},p_\text{DF})$ for a given qDF and potential . We do this by integrating the qDF at a given $(R,z)$ over all three velocity components, using a $N_\text{velocity}$-th order Gauss-Legendre quadrature for each integral:
\begin{eqnarray}
\rho_\text{DF}(R,|z| \mid p_{\Phi},p_\text{DF}) &=& \int_{-\infty}^{\infty} \text{qDF}(\vect{J}[R,z,\vect{v} \mid p_{\Phi}] \mid p_\text{DF}) \Diff3\vect{v}  \label{eq:tracerdensity_general}\\
&\approx& \int_{-N_\text{sigma} \sigma_R(R \mid p_\text{DF})}^{N_\text{sigma} \sigma_R(R \mid p_\text{DF})} \int_{-N_\text{sigma}\sigma_z(R \mid p_\text{DF})}^{N_\text{sigma} \sigma_z(R \mid p_\text{DF})} \int_{0}^{1.5 v_\text{circ}(R_\odot)}  \nonumber\\
& & \hspace{1cm} \text{qDF}(J[R,z,\vect{v} \mid p_{\Phi}] \mid p_\text{DF}) \diff v_T \diff v_z \diff v_R, \label{eq:tracerdensity}
\end{eqnarray}
where $\sigma_R(R \mid p_\text{DF})$ and $\sigma_z(R \mid p_\text{DF})$ are given by eq. (\ref{eq:sigmaRRg}) and (\ref{eq:sigmazRg}) and the integration ranges are motivated by Fig. \ref{fig:mockdatadistr}. For a given $p_\Phi$ and $p_\text{DF}$ we explicitly calculate the density on $N_\text{spatial} \times N_\text{spatial}$ regular grid points in the $(R,z)$ plane; in between grid points the density is evaluated with a bivariate spline interpolation. The grid is chosen to cover the extent of the observations for $z>0$. The total number of actions that need to be calculated to set up the density interpolation grid is $N_\text{spatial}^2 \cdot N_\text{velocity}^3$. Fig. ??? shows the importance of choosing $N_\text{spatial}$, $N_\text{velocity}$ and $N_\text{sigma}$ sufficiently large in order to get the density with an acceptable numerical accuracy. 

%======================================================================================

\begin{deluxetable}{lccccc}
\tabletypesize{\scriptsize}
%\rotate
\tablecaption{Reference distribution function parameters for the qDF in eq. (\ref{eq:df_general})-(\ref{eq:sigmazRg}). These qDFs describe the phase-space distribution of stellar \MAPs for which mock data is created and analysed throughout this work for testing purposes. The parameters of the "cooler" \& "colder"  ("hotter" \& "warmer") \MAPs were chosen such, that the they have the same $\sigma_R/\sigma_z$ ratio as the "hot" ("cool") \MAP. The "colder" and "warmer" \MAPs have a free parameter $X$ that governs how much colder/warmer they are then the reference "hot" and "cool" qDFs. Hotter populations have shorter tracer scale lengths \citep{bov12d} and the velocity dispersion scale lengths were fixed according to \citet{bov12c}. \label{tbl:referenceMAPs}}
\tablewidth{0pt}
\tablehead{
\colhead{name of \MAP} & \multicolumn{5}{c}{qDF parameters $p_\text{DF}$}\\
                       & \colhead{$h_R$ [kpc]} & \colhead{$\sigma_R$ [km s$^{-1}$]} & \colhead{$\sigma_z$ [km s$^{-1}$]} & \colhead{$h_{\sigma_R}$ [kpc]} & \colhead{$h_{\sigma_z}$ [kpc]}}
\startdata
"hot"    & 2   & 55 & 66 & 8 & 7\\
"cool"   & 3.5 & 42 & 32 & 8 & 7\\
\tableline
"cooler" & 2  +50\% & 55-50\% & 66-50\% & 8 & 7 \\
"hotter" & 3.5-50\% & 42+50\% & 32+50\% & 8 & 7\\
\tableline
"colder" & 2  +X\% & 55-X\% & 66-X\% & 8 & 7 \\
"warmer" & 3.5-X\% & 42+X\% & 32+X\% & 8 & 7\\
\enddata
\end{deluxetable}

%======================================================================================


\subsection{Selection Function}

\paragraph{Galactic Coordinate System.} Our modelling takes place in the Galactocentric rest-frame with cylindrical coordinates $\vect{x} \equiv (R,\phi,z)$ and corresponding velocity components $\vect{v} \equiv (v_R,v_\phi,v_z)$. If the stellar phase-space data is given in observed coordinates, position $\tilde{\vect{x}} \equiv(\alpha,\delta,m-M)$ in right ascension $\alpha$, declination $\delta$ and distance modulus $(m-M)$, and velocity $\tilde{\vect{v}} \equiv (\mu_\alpha,\mu_\delta,v_\text{los})$ as proper motions $\vect{\mu}=(\mu_\alpha,\mu_\delta)$ [TO DO: cos somwhere???] and line-of-sight velocity $v_\text{los}$, the data $(\tilde{\vect{x}},\tilde{\vect{v}})$ has to be converted first into the Galactocentric rest-frame coordinates $(\vect{x},\vect{v})$ using the sun's position and velocity. For simplicity we assume for the sun
\begin{eqnarray*}
(R_\odot,\phi_\odot,z_\odot) &=&(8 \text{ kpc}, 0^\circ, 0 \text{ kpc})\\
(v_{R,\odot},v_{T,\odot},v_{z,\odot}) &=& (0,230,0) \text{ km s}^{-1}.
\end{eqnarray*}

\paragraph{Selection Function.} A survey's selection function can be understood as a subvolume in the space of observables: e.g. position on the plane of the sky (limited by the pointing of the survey), distance from the sun (limited by the brightness of the stars and the sensitivity of the detector), colors and metallicity of the stars (limited by survey mode and targeting).
\\Within the framework of this paper, using only mock data for testing purposes, we ignore target cuts in colors and metallicity and simply use spatial selection functions, which we define as
\begin{eqnarray*}
\text{sf}(\vect{x}) \equiv \begin{cases}
\text{completeness}(\vect{x}) &\text{if $\vect{x}$ within observed volume}\\
0 & \text{outside}
\end{cases}
\end{eqnarray*}
It's value describes the probability to observe a star at $\vect{x}$. 
\\For the observed volume we use simple geometrical shapes: Either a sphere of radius $r_\text{max}$ with the sun at its center, or a "wedge", which we define as the angular segment of an cylindrical annuli, i.e. the volume with $R \in [R_\text{min},R_\text{max}],\phi \in [\phi_\text{min},\phi_\text{max}],z \in [z_\text{min},z_\text{max}]$ within the model galaxy.
\\The completeness is, in our framework, a function of position with $0 \leq \text{completeness}(\vect{x}) \leq 1$ everywhere inside the observed volume. It could be understood as a position-dependent detection probability. Unless explicitly stated otherwise, we use everywhere
$$\text{completeness}(\vect{x}) = 1.$$